<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Whack-A-Mole: Ultimate - K4 Games</title>
    <style>
        :root {
            --grass: #2ecc71;
            --dirt: #795548;
            --mole: #a1887f;
            --accent: #e94560;
            --bg: #0f172a;
            --panel: #ffffff;
            --text: #1e293b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: manipulation;
        }

        #ui-top {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .stat-pill {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            text-align: center;
        }
        .stat-val { font-size: 1.5rem; font-weight: 900; color: #38bdf8; display: block; line-height: 1; }
        .stat-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.7; }

        #game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 95vw;
            max-width: 500px;
            aspect-ratio: 1;
        }

        .hole {
            position: relative;
            background: var(--dirt);
            border-radius: 50%;
            overflow: hidden;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.5);
            border: 4px solid #5d4037;
        }

        .mole {
            position: absolute;
            bottom: -100%;
            left: 10%;
            width: 80%;
            height: 90%;
            background: var(--mole);
            border-radius: 50% 50% 20% 20%;
            transition: bottom 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 15%;
            cursor: pointer;
        }

        .mole.up { bottom: 0; }
        .mole.hit { background: #ef4444 !important; transition: none; }

        .mole-eyes {
            display: flex;
            gap: 20%;
            width: 60%;
        }
        .eye { width: 8px; height: 8px; background: #000; border-radius: 50%; }
        .mole-nose { width: 12px; height: 8px; background: #000; border-radius: 50%; margin-top: 5px; }

        .back-link {
            position: fixed; top: 20px; left: 20px; color: white; text-decoration: none;
            background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 12px; z-index: 100;
            font-weight: bold; border: 1px solid rgba(255,255,255,0.1);
        }

        #overlay {
            position: fixed; inset: 0; background: rgba(15, 23, 42, 0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 1000; backdrop-filter: blur(10px); text-align: center; padding: 20px;
        }

        .btn {
            background: #38bdf8; color: #0f172a; border: none; padding: 15px 40px;
            border-radius: 50px; font-weight: 900; cursor: pointer; font-size: 1.2rem;
            margin-top: 20px; transition: 0.2s; width: 100%; max-width: 300px;
        }
        .btn:hover { transform: scale(1.05); filter: brightness(1.1); }

        .difficulty-select { display: flex; gap: 10px; margin-top: 20px; width: 100%; max-width: 300px; }
        .diff-btn {
            flex: 1; padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05); color: white; cursor: pointer; font-weight: bold;
        }
        .diff-btn.active { background: #38bdf8; color: #0f172a; border-color: #38bdf8; }

        .whack-text {
            position: absolute; color: #fbbf24; font-weight: 900; font-size: 1.5rem;
            pointer-events: none; animation: floatUp 0.5s ease-out forwards;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê HUB</a>

    <div id="ui-top">
        <div class="stat-pill">
            <span class="stat-label">Score</span>
            <span id="score" class="stat-val">0</span>
        </div>
        <div class="stat-pill">
            <span class="stat-label">Time</span>
            <span id="timer" class="stat-val">30</span>
        </div>
        <div class="stat-pill">
            <span class="stat-label">Best</span>
            <span id="high-score" class="stat-val">0</span>
        </div>
    </div>

    <div id="game-board">
        <!-- 9 holes -->
        <div class="hole"><div class="mole">
            <div class="mole-eyes"><div class="eye"></div><div class="eye"></div></div>
            <div class="mole-nose"></div>
        </div></div>
        <div class="hole"><div class="mole">
            <div class="mole-eyes"><div class="eye"></div><div class="eye"></div></div>
            <div class="mole-nose"></div>
        </div></div>
        <div class="hole"><div class="mole">
            <div class="mole-eyes"><div class="eye"></div><div class="eye"></div></div>
            <div class="mole-nose"></div>
        </div></div>
        <div class="hole"><div class="mole">
            <div class="mole-eyes"><div class="eye"></div><div class="eye"></div></div>
            <div class="mole-nose"></div>
        </div></div>
        <div class="hole"><div class="mole">
            <div class="mole-eyes"><div class="eye"></div><div class="eye"></div></div>
            <div class="mole-nose"></div>
        </div></div>
        <div class="hole"><div class="mole">
            <div class="mole-eyes"><div class="eye"></div><div class="eye"></div></div>
            <div class="mole-nose"></div>
        </div></div>
        <div class="hole"><div class="mole">
            <div class="mole-eyes"><div class="eye"></div><div class="eye"></div></div>
            <div class="mole-nose"></div>
        </div></div>
        <div class="hole"><div class="mole">
            <div class="mole-eyes"><div class="eye"></div><div class="eye"></div></div>
            <div class="mole-nose"></div>
        </div></div>
        <div class="hole"><div class="mole">
            <div class="mole-eyes"><div class="eye"></div><div class="eye"></div></div>
            <div class="mole-nose"></div>
        </div></div>
    </div>

    <div id="overlay">
        <h1 style="font-size: 3rem; color: #38bdf8; margin-bottom: 10px;">WHACK-A-MOLE</h1>
        <p id="overlay-msg" style="color: #94a3b8;">Select difficulty and start whacking!</p>
        
        <div class="difficulty-select">
            <button class="diff-btn" onclick="setDifficulty('easy', this)">Easy</button>
            <button class="diff-btn active" onclick="setDifficulty('medium', this)">Med</button>
            <button class="diff-btn" onclick="setDifficulty('hard', this)">Hard</button>
        </div>

        <button class="btn" onclick="startGame()">START GAME</button>
    </div>

    <script>
        const holes = document.querySelectorAll('.hole');
        const moles = document.querySelectorAll('.mole');
        const scoreEl = document.getElementById('score');
        const timerEl = document.getElementById('timer');
        const highScoreEl = document.getElementById('high-score');
        const overlay = document.getElementById('overlay');

        let lastHole;
        let timeUp = false;
        let score = 0;
        let timeLeft = 30;
        let timerInterval;
        let moleTimeout;
        let difficulty = 'medium';
        let highScore = parseInt(localStorage.getItem('whackAMoleHighScore') || '0');

        highScoreEl.textContent = highScore;

        const SETTINGS = {
            easy: { min: 800, max: 1500 },
            medium: { min: 400, max: 1000 },
            hard: { min: 200, max: 600 }
        };

        function setDifficulty(d, btn) {
            difficulty = d;
            document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function randomTime(min, max) {
            return Math.round(Math.random() * (max - min) + min);
        }

        function randomHole(holes) {
            const idx = Math.floor(Math.random() * holes.length);
            const hole = holes[idx];
            if (hole === lastHole) return randomHole(holes);
            lastHole = hole;
            return hole;
        }

        function peep() {
            const time = randomTime(SETTINGS[difficulty].min, SETTINGS[difficulty].max);
            const hole = randomHole(holes);
            const mole = hole.querySelector('.mole');
            mole.classList.add('up');
            
            moleTimeout = setTimeout(() => {
                mole.classList.remove('up');
                if (!timeUp) peep();
            }, time);
        }

        function startGame() {
            score = 0;
            timeLeft = 30;
            timeUp = false;
            scoreEl.textContent = 0;
            timerEl.textContent = 30;
            overlay.style.display = 'none';
            
            peep();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timeUp = true;
                    showGameOver();
                }
            }, 1000);
        }

        function showGameOver() {
            overlay.style.display = 'flex';
            document.getElementById('overlay-title').textContent = "GAME OVER";
            document.getElementById('overlay-msg').textContent = `Final Score: ${score}`;
            
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('whackAMoleHighScore', highScore);
                highScoreEl.textContent = highScore;
                document.getElementById('overlay-msg').innerHTML += "<br><span style='color:#fbbf24'>NEW HIGH SCORE!</span>";
            }
        }

        function whack(e) {
            if (!e.isTrusted) return; // prevent cheat
            if (!this.classList.contains('up')) return;
            
            score++;
            this.classList.remove('up');
            this.classList.add('hit');
            
            // Synthesized whack sound
            playWhackSound();

            // Visual feedback
            const text = document.createElement('div');
            text.className = 'whack-text';
            text.textContent = 'WHACK!';
            text.style.left = e.pageX + 'px';
            text.style.top = e.pageY + 'px';
            document.body.appendChild(text);
            setTimeout(() => text.remove(), 500);

            setTimeout(() => this.classList.remove('hit'), 100);
            scoreEl.textContent = score;
        }

        let audioCtx;
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playWhackSound() {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        moles.forEach(mole => mole.addEventListener('mousedown', whack));
        moles.forEach(mole => mole.addEventListener('touchstart', (e) => {
            e.preventDefault();
            whack.call(mole, { isTrusted: true, pageX: e.touches[0].pageX, pageY: e.touches[0].pageY });
        }));

    </script>
</body>
</html>