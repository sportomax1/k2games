<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Football: Championship Edition - K4 Games</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a;
            --surface: #1e293b;
            --accent: #fbbf24;
            --field: #15803d;
            --p1: #3b82f6;
            --p2: #ef4444;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        
        body {
            background-color: var(--bg);
            background-image: radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.1) 0, transparent 50%);
            color: white;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Sidebar UI */
        #sidebar {
            width: 350px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 2rem;
            z-index: 100;
            box-shadow: 10px 0 30px rgba(0,0,0,0.3);
        }

        .logo { 
            font-size: 2rem; font-weight: 900; color: var(--accent); 
            letter-spacing: -1px; margin-bottom: 2rem; font-style: italic;
        }

        .status-card {
            background: var(--glass);
            border: 1px solid var(--border);
            padding: 1.5rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .down-dist { font-size: 1.8rem; font-weight: 900; color: white; }
        .ball-on { font-size: 0.9rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }

        .playbook { display: flex; flex-direction: column; gap: 12px; }
        
        .play-btn {
            background: var(--glass);
            border: 1px solid var(--border);
            padding: 1rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: left;
        }
        .play-btn:hover:not(:disabled) { background: rgba(255,255,255,0.08); transform: translateX(5px); border-color: white; }
        .play-btn:active:not(:disabled) { transform: scale(0.98); }
        .play-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        
        .play-icon { font-size: 1.5rem; width: 40px; text-align: center; }
        .play-info b { display: block; font-size: 1rem; }
        .play-info span { font-size: 0.75rem; opacity: 0.6; text-transform: uppercase; }

        /* Main View */
        #main-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            position: relative;
        }

        #scoreboard {
            background: #000;
            border-radius: 20px;
            padding: 1.5rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 4px solid #334155;
            margin-bottom: 2rem;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }

        .team-box { text-align: center; }
        .team-name { font-size: 0.8rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; opacity: 0.6; }
        .team-score { font-size: 4rem; font-weight: 900; font-family: 'JetBrains Mono', monospace; line-height: 1; }
        
        .game-clock { text-align: center; color: var(--accent); }
        .time { font-size: 2.5rem; font-weight: 700; font-family: monospace; }
        .qtr { font-size: 0.9rem; font-weight: 800; opacity: 0.8; }

        #field-container {
            flex: 1;
            background: var(--field);
            border-radius: 30px;
            border: 10px solid #ffffff10;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* Dice Overlay */
        #dice-overlay {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(8px);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 500;
        }

        .dice-result {
            display: flex;
            gap: 30px;
            margin-top: 2rem;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .die {
            width: 100px; height: 100px;
            background: white;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #1e293b;
            font-weight: 900;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .coin {
            width: 80px; height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 900;
            text-transform: uppercase;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .coin-green { background: #22c55e; color: #064e3b; border: 4px solid #059669; }
        .coin-red { background: #ef4444; color: #7f1d1d; border: 4px solid #dc2626; }

        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        #event-msg {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            font-weight: 900;
            font-style: italic;
            color: var(--accent);
            text-shadow: 0 0 30px rgba(0,0,0,0.8);
            z-index: 600;
            display: none;
            text-align: center;
            pointer-events: none;
        }

        .back-link {
            position: fixed; top: 20px; left: 20px; color: white; text-decoration: none;
            background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 12px; z-index: 1000;
            font-weight: bold; backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê HUB</a>

    <aside id="sidebar">
        <div class="logo">DICE FOOTBALL</div>
        
        <div class="status-card">
            <div id="ball-pos" class="ball-on">BALL ON OWN 20</div>
            <div id="down-info" class="down-dist">1ST & 10</div>
        </div>

        <div style="font-weight: 800; font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; margin-bottom: 10px;">Select Play</div>
        <div class="playbook">
            <button class="play-btn" onclick="game.play('run')">
                <div class="play-icon">üèÉ</div>
                <div class="play-info"><b>Power Run</b><span>Safe (D6) ‚Ä¢ Low Risk</span></div>
            </button>
            <button class="play-btn" onclick="game.play('pass')">
                <div class="play-icon">üèà</div>
                <div class="play-info"><b>Deep Pass</b><span>High Reward (D20) ‚Ä¢ Risky</span></div>
            </button>
            <button class="play-btn" id="punt-btn" onclick="game.play('punt')">
                <div class="play-icon">üëü</div>
                <div class="play-info"><b>Punt Ball</b><span>Turnover ‚Ä¢ Clear Field</span></div>
            </button>
            <button class="play-btn" id="fg-btn" onclick="game.play('fg')">
                <div class="play-icon">üéØ</div>
                <div class="play-info"><b>Field Goal</b><span>3 Points ‚Ä¢ Near Endzone</span></div>
            </button>
        </div>

        <div style="margin-top: auto; padding-top: 2rem;">
            <button onclick="location.reload()" style="width: 100%; padding: 1rem; border-radius: 12px; background: #334155; border: none; color: white; font-weight: 700; cursor: pointer;">NEW MATCH</button>
        </div>
    </aside>

    <main id="main-view">
        <div id="scoreboard">
            <div class="team-box">
                <div class="team-name">Player Team</div>
                <div id="p-score" class="team-score" style="color: var(--p1)">00</div>
            </div>
            <div class="game-clock">
                <div id="qtr-val" class="qtr">1ST QUARTER</div>
                <div id="clock-val" class="time">15:00</div>
            </div>
            <div class="team-box">
                <div class="team-name">Rival CPU</div>
                <div id="ai-score" class="team-score" style="color: var(--p2)">00</div>
            </div>
        </div>

        <div id="field-container">
            <canvas id="fieldCanvas"></canvas>
            <div id="event-msg">TOUCHDOWN!</div>
        </div>

        <div id="dice-overlay">
            <h2 style="font-size: 2rem; font-weight: 900;">THE RESULTS...</h2>
            <div class="dice-result">
                <div id="success-coin" class="coin">GREEN</div>
                <div id="main-die" class="die">6</div>
            </div>
            <div id="result-text" style="margin-top: 2rem; font-size: 1.2rem; opacity: 0.8; font-weight: 600;">Gained 6 yards!</div>
            <button class="btn" style="margin-top: 3rem; background: var(--accent); color: #000; border: none; padding: 1rem 3rem; border-radius: 50px; font-weight: 900; cursor: pointer;" onclick="game.closeDice()">CONTINUE</button>
        </div>
    </main>

    <script>
        class DiceFootball {
            constructor() {
                this.canvas = document.getElementById('fieldCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.resize();

                this.state = {
                    score: { p: 0, ai: 0 },
                    qtr: 1,
                    time: 900,
                    possession: 'p', // p or ai
                    down: 1,
                    dist: 10,
                    yardLine: 20, // 0 to 100 (0=P1 EZ, 100=AI EZ)
                    gameOver: false
                };

                this.setupField();
                this.updateUI();
                window.addEventListener('resize', () => this.resize());
                this.loop();
            }

            resize() {
                this.canvas.width = this.canvas.clientWidth;
                this.canvas.height = this.canvas.clientHeight;
            }

            setupField() {
                // Pre-draw or set markers
            }

            updateUI() {
                document.getElementById('p-score').textContent = this.state.score.p.toString().padStart(2, '0');
                document.getElementById('ai-score').textContent = this.state.score.ai.toString().padStart(2, '0');
                
                const mins = Math.floor(this.state.time / 60);
                const secs = this.state.time % 60;
                document.getElementById('clock-val').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                document.getElementById('qtr-val').textContent = `${['1ST','2ND','3RD','4TH'][this.state.qtr-1]} QUARTER`;
                
                const yard = this.state.possession === 'p' ? this.state.yardLine : (100 - this.state.yardLine);
                document.getElementById('ball-pos').textContent = `BALL ON ${yard < 50 ? 'OWN' : 'OPP'} ${yard > 50 ? 100 - yard : yard}`;
                document.getElementById('down-info').textContent = `${['1ST','2ND','3RD','4TH'][this.state.down-1]} & ${this.state.dist}`;

                // Play buttons
                const isPlayer = this.state.possession === 'p';
                document.querySelectorAll('.play-btn').forEach(b => b.disabled = !isPlayer);
                
                // FG logic: can kick if within 40 yards of EZ
                const fgBtn = document.getElementById('fg-btn');
                const distToEZ = isPlayer ? (100 - this.state.yardLine) : this.state.yardLine;
                if(isPlayer) fgBtn.style.display = distToEZ < 45 ? 'flex' : 'none';
                
                const puntBtn = document.getElementById('punt-btn');
                puntBtn.style.display = this.state.down === 4 ? 'flex' : 'none';
            }

            async play(type) {
                if(this.animating) return;
                this.animating = true;

                // Show "Shaking..." state
                const overlay = document.getElementById('dice-overlay');
                const coin = document.getElementById('success-coin');
                const die = document.getElementById('main-die');
                const res = document.getElementById('result-text');
                const btn = overlay.querySelector('.btn');

                overlay.style.display = 'flex';
                coin.style.display = 'none';
                die.style.display = 'none';
                res.textContent = "SHAKING DICE...";
                btn.style.display = 'none';

                await new Promise(r => setTimeout(r, 800));

                let yards = 0;
                let success = Math.random() > 0.5; // Success Coin
                let dieVal = 0;
                let resultTxt = "";

                if(type === 'run') {
                    dieVal = Math.floor(Math.random() * 6) + 1;
                    if(success) {
                        yards = dieVal;
                        resultTxt = `Great blocking! Gained ${yards} yards.`;
                    } else {
                        yards = -Math.floor(dieVal/2);
                        resultTxt = `Stuffed at the line! Lost ${Math.abs(yards)} yards.`;
                    }
                } else if(type === 'pass') {
                    dieVal = Math.floor(Math.random() * 20) + 1;
                    if(success) {
                        yards = dieVal;
                        resultTxt = `COMPLETED! A huge ${yards} yard gain!`;
                    } else {
                        if(dieVal === 1) {
                            overlay.style.display = 'none';
                            this.handleTurnover('INTERCEPTION!');
                            return;
                        } else if(dieVal < 5) {
                            yards = -7;
                            resultTxt = `SACKED! Lost 7 yards.`;
                        } else {
                            yards = 0;
                            resultTxt = `Incomplete pass.`;
                        }
                    }
                } else if(type === 'punt') {
                    overlay.style.display = 'none';
                    const dist = 30 + Math.floor(Math.random() * 30);
                    this.showEvent(`PUNTED ${dist} YDS`);
                    setTimeout(() => this.changePossession(dist), 1500);
                    return;
                } else if(type === 'fg') {
                    overlay.style.display = 'none';
                    const distToEZ = this.state.possession === 'p' ? (100 - this.state.yardLine) : this.state.yardLine;
                    const kickDist = distToEZ + 10;
                    const accuracy = Math.random() * 60;
                    if(accuracy > kickDist) {
                        this.scorePoints(3);
                    } else {
                        this.showEvent('MISSED FG!');
                        setTimeout(() => this.changePossession(0), 1500);
                    }
                    return;
                }

                coin.className = `coin ${success ? 'coin-green' : 'coin-red'}`;
                coin.textContent = success ? 'GREEN' : 'RED';
                coin.style.display = 'flex';
                die.textContent = dieVal;
                die.style.display = 'flex';
                res.textContent = resultTxt;
                btn.style.display = 'block';

                this.pendingYards = yards;
            }

            closeDice() {
                document.getElementById('dice-overlay').style.display = 'none';
                this.applyYards(this.pendingYards);
                this.animating = false;
            }

            applyYards(yards) {
                const dir = this.state.possession === 'p' ? 1 : -1;
                this.state.yardLine += (yards * dir);
                this.state.time -= 30;

                if (this.state.time <= 0) {
                    this.state.time = 0;
                    this.endGame("TIME EXPIRED");
                    return;
                }

                // Check TD
                if(this.state.yardLine >= 100 || this.state.yardLine <= 0) {
                    this.scorePoints(7);
                    return;
                }

                // Down logic
                this.state.dist -= yards;
                if(this.state.dist <= 0) {
                    this.state.down = 1;
                    this.state.dist = 10;
                    this.showEvent('FIRST DOWN!');
                } else {
                    this.state.down++;
                    if(this.state.down > 4) {
                        this.handleTurnover('TURNOVER ON DOWNS');
                        return;
                    }
                }

                this.updateUI();
                if(this.state.possession === 'ai') setTimeout(() => this.aiTurn(), 1000);
            }

            scorePoints(pts) {
                this.state.score[this.state.possession] += pts;
                this.showEvent(pts === 7 ? 'TOUCHDOWN!' : 'FIELD GOAL!');
                
                setTimeout(() => {
                    this.state.possession = this.state.possession === 'p' ? 'ai' : 'p';
                    // Kickoff: Receiving team starts at their own 20
                    this.state.yardLine = this.state.possession === 'p' ? 20 : 80;
                    this.state.down = 1;
                    this.state.dist = 10;
                    this.updateUI();
                    if(this.state.possession === 'ai') this.aiTurn();
                }, 2000);
            }

            handleTurnover(msg) {
                this.showEvent(msg);
                setTimeout(() => {
                    this.state.possession = this.state.possession === 'p' ? 'ai' : 'p';
                    this.state.down = 1;
                    this.state.dist = 10;
                    this.updateUI();
                    this.animating = false;
                    if(this.state.possession === 'ai') this.aiTurn();
                }, 2000);
            }

            changePossession(puntDist) {
                const oldPoss = this.state.possession;
                this.state.possession = oldPoss === 'p' ? 'ai' : 'p';
                
                // Move ball for punt
                const dir = oldPoss === 'p' ? 1 : -1;
                let newYL = this.state.yardLine + (puntDist * dir);
                
                // Touchback check
                if (newYL > 100) newYL = 80;
                if (newYL < 0) newYL = 20;
                
                this.state.yardLine = newYL;
                this.state.down = 1;
                this.state.dist = 10;
                this.updateUI();
                this.animating = false;
                if(this.state.possession === 'ai') setTimeout(() => this.aiTurn(), 1000);
            }

            endGame(msg) {
                this.state.gameOver = true;
                this.showEvent(msg || "GAME OVER");
                const winMsg = this.state.score.p > this.state.score.ai ? "YOU WIN!" : "CPU WINS";
                setTimeout(() => {
                    alert(`${msg || 'GAME OVER'}! Final Score: ${this.state.score.p} - ${this.state.score.ai}. ${winMsg}`);
                }, 1000);
            }

            showEvent(txt) {
                const el = document.getElementById('event-msg');
                el.textContent = txt;
                el.style.display = 'block';
                setTimeout(() => el.style.display = 'none', 2000);
            }

            aiTurn() {
                if(this.state.gameOver) return;
                const type = Math.random() > 0.4 ? 'run' : 'pass';
                this.play(type);
            }

            draw() {
                const ctx = this.ctx;
                const w = this.canvas.width;
                const h = this.canvas.height;
                ctx.clearRect(0,0,w,h);

                // Field Markings
                ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                ctx.lineWidth = 2;
                
                // Endzones
                ctx.fillStyle = 'rgba(59, 130, 246, 0.3)';
                ctx.fillRect(0, 0, w*0.1, h);
                ctx.fillStyle = 'rgba(239, 68, 68, 0.3)';
                ctx.fillRect(w*0.9, 0, w*0.1, h);

                // Yard Lines
                for(let i=0; i<=100; i+=10) {
                    const x = (w * 0.8 * (i/100)) + (w * 0.1);
                    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke();
                    
                    // Numbers
                    ctx.fillStyle = 'rgba(255,255,255,0.5)';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'center';
                    if(i > 0 && i < 100) {
                        const val = i > 50 ? 100 - i : i;
                        ctx.fillText(val, x, 30);
                        ctx.fillText(val, x, h - 20);
                    }
                }

                // The Ball
                const ballX = (w * 0.8 * (this.state.yardLine/100)) + (w * 0.1);
                ctx.shadowBlur = 20; ctx.shadowColor = 'rgba(0,0,0,0.5)';
                ctx.fillStyle = '#795548';
                ctx.beginPath();
                ctx.ellipse(ballX, h/2, 15, 10, this.state.possession === 'p' ? 0.3 : -0.3, 0, Math.PI*2);
                ctx.fill();
                ctx.strokeStyle = 'white'; ctx.lineWidth = 2; ctx.stroke();
                ctx.shadowBlur = 0;

                // First Down Line
                const fdYard = this.state.possession === 'p' ? (this.state.yardLine + this.state.dist) : (this.state.yardLine - this.state.dist);
                const fdX = (w * 0.8 * (fdYard/100)) + (w * 0.1);
                ctx.strokeStyle = '#fbbf24'; ctx.lineWidth = 4;
                ctx.setLineDash([5, 5]);
                ctx.beginPath(); ctx.moveTo(fdX, 0); ctx.lineTo(fdX, h); ctx.stroke();
                ctx.setLineDash([]);
            }

            loop() {
                this.draw();
                requestAnimationFrame(() => this.loop());
            }
        }

        window.onload = () => { window.game = new DiceFootball(); };
    </script>
</body>
</html>