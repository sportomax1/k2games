<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olympic Javelin Elite - K4 Games</title>
    <style>
        :root {
            --track: #f97316;
            --field: #22c55e;
            --sky-top: #0ea5e9;
            --sky-bottom: #7dd3fc;
            --bg: #0f172a;
            --gold: #fbbf24;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 1100px;
            height: 600px;
            background: linear-gradient(to bottom, var(--sky-top), var(--sky-bottom));
            border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* UI Layer */
        #ui-layer {
            position: absolute;
            inset: 0;
            pointer-events: none;
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .hud-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .stat-card {
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(12px);
            padding: 15px 30px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            min-width: 150px;
        }

        .stat-val { font-size: 2rem; font-weight: 900; color: var(--gold); font-family: monospace; }
        .stat-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.7; margin-bottom: 4px; }

        .meters-container {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            pointer-events: none;
        }

        .meter-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .gauge-bg {
            width: 12px;
            height: 150px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .gauge-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            transition: height 0.1s;
        }

        .gauge-target {
            position: absolute;
            bottom: 40%;
            width: 100%;
            height: 20%;
            background: rgba(255,255,255,0.3);
            border-top: 2px solid #fff;
            border-bottom: 2px solid #fff;
        }

        .back-link {
            position: fixed; top: 20px; left: 20px; color: white; text-decoration: none;
            background: rgba(255,255,255,0.1); padding: 12px 24px; border-radius: 14px; z-index: 100;
            font-weight: bold; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            transition: 0.2s;
        }
        .back-link:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px); }

        #overlay {
            position: absolute; inset: 0; background: rgba(15, 23, 42, 0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 1000; backdrop-filter: blur(10px); text-align: center;
        }

        .btn {
            background: var(--gold); color: #000; border: none; padding: 18px 50px;
            border-radius: 50px; font-weight: 900; cursor: pointer; font-size: 1.4rem;
            margin-top: 30px; transition: 0.2s; box-shadow: 0 10px 25px -5px rgba(251, 191, 36, 0.4);
        }
        .btn:hover { transform: scale(1.05); filter: brightness(1.1); }

        .wind-box {
            position: absolute;
            top: 150px;
            right: 30px;
            text-align: right;
        }

        #msg-box {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-size: 5rem; font-weight: 900; color: #ef4444; text-shadow: 0 0 30px black;
            opacity: 0; pointer-events: none; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #msg-box.show { opacity: 1; transform: translate(-50%, -60%); }

        .round-tracker {
            display: flex; gap: 10px; margin-top: 10px;
        }
        .round-dot { width: 12px; height: 12px; border-radius: 50%; background: rgba(255,255,255,0.2); }
        .round-dot.active { background: var(--gold); box-shadow: 0 0 10px var(--gold); }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← HUB</a>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="ui-layer">
            <div class="hud-top">
                <div class="stat-card">
                    <div class="stat-label">Best Attempt</div>
                    <div id="best-val" class="stat-val">0.00m</div>
                    <div class="round-tracker" id="rounds">
                        <div class="round-dot active"></div>
                        <div class="round-dot"></div>
                        <div class="round-dot"></div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Current Attempt</div>
                    <div id="current-val" class="stat-val">0.00m</div>
                </div>
            </div>

            <div class="wind-box">
                <div class="stat-label">Wind</div>
                <div id="wind-val" style="font-weight: 800; font-size: 1.2rem;">0.0 m/s →</div>
            </div>

            <div class="meters-container">
                <div class="meter-box">
                    <div class="stat-label" style="color: #f87171">Speed</div>
                    <div class="gauge-bg">
                        <div id="speed-fill" class="gauge-fill" style="height: 0%; background: #f87171"></div>
                    </div>
                </div>
                <div class="meter-box">
                    <div class="stat-label" style="color: #38bdf8">Angle</div>
                    <div class="gauge-bg">
                        <div class="gauge-target"></div>
                        <div id="angle-fill" class="gauge-fill" style="height: 0%; background: #38bdf8"></div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; color: rgba(255,255,255,0.4); font-size: 0.9rem; font-weight: 600; letter-spacing: 1px;">
                MASH <span style="color:#fff">SPACE</span> TO RUN • PRESS <span style="color:#fff">T</span> TO THROW
            </div>
        </div>

        <div id="msg-box">FAULT!</div>

        <div id="overlay">
            <h1 style="font-size: 4rem; color: var(--gold); font-style: italic; letter-spacing: 2px;">JAVELIN ELITE</h1>
            <p style="font-size: 1.2rem; opacity: 0.8; max-width: 500px;">Build up speed and time your release angle perfectly before the foul line. 3 attempts to take the gold.</p>
            <button class="btn" onclick="startGame()">ENTER ARENA</button>
        </div>
    </div>

    <script>
        class Javelin {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.width = 1100;
                this.height = 600;
                this.canvas.width = this.width;
                this.canvas.height = this.height;

                this.bestDist = 0;
                this.round = 0;
                this.attempts = [];
                this.wind = 0;
                this.reset();
                this.setupInput();
                this.loop();
            }

            reset() {
                this.state = 'idle'; // idle, running, flight, result, complete
                this.player = { x: 100, y: 480, speed: 0, frame: 0 };
                this.javelin = { x: 0, y: 0, vx: 0, vy: 0, angle: 0, active: false, rot: 0 };
                this.lineX = 750;
                this.offset = 0;
                this.isFault = false;
                this.angleVal = 0;
                this.angleDir = 1;
                this.wind = (Math.random() - 0.5) * 4; // Wind speed -2 to +2
                
                document.getElementById('current-val').textContent = '0.00m';
                document.getElementById('speed-fill').style.height = '0%';
                document.getElementById('angle-fill').style.height = '0%';
                this.updateWindUI();
                this.updateRoundUI();
            }

            updateWindUI() {
                const w = document.getElementById('wind-val');
                const dir = this.wind > 0 ? '→' : '←';
                w.textContent = `${Math.abs(this.wind).toFixed(1)} m/s ${dir}`;
                w.style.color = Math.abs(this.wind) > 1.5 ? '#f87171' : '#fff';
            }

            updateRoundUI() {
                const dots = document.querySelectorAll('.round-dot');
                dots.forEach((d, i) => {
                    d.classList.toggle('active', i === this.round);
                });
            }

            setupInput() {
                window.onkeydown = (e) => {
                    if(this.state === 'running') {
                        if(e.code === 'Space') {
                            this.player.speed = Math.min(15, this.player.speed + 1.2);
                            this.player.frame += 0.5;
                        }
                        if(e.code === 'KeyT') {
                            this.throw();
                        }
                    }
                };
            }

            throw() {
                if(this.player.x + this.offset > this.lineX) {
                    this.triggerFault();
                    return;
                }

                this.state = 'flight';
                // Angle logic: 0 to 90 degrees. Sweet spot is around 45 (50% on meter)
                const releaseAngleDeg = this.angleVal * 0.9; // 0-90
                const angleRad = -releaseAngleDeg * Math.PI / 180;
                const power = this.player.speed;
                
                this.javelin = {
                    x: this.player.x,
                    y: this.player.y - 60,
                    vx: power * 1.4 + (this.wind * 0.5),
                    vy: Math.sin(angleRad) * (power * 1.8),
                    angle: angleRad,
                    active: true,
                    rot: angleRad
                };
            }

            triggerFault() {
                this.state = 'result';
                this.isFault = true;
                const msg = document.getElementById('msg-box');
                msg.textContent = 'FAULT!';
                msg.classList.add('show');
                this.attempts.push(0);
                setTimeout(() => this.nextAttempt(), 2000);
            }

            nextAttempt() {
                const msg = document.getElementById('msg-box');
                msg.classList.remove('show');
                this.round++;
                if(this.round >= 3) {
                    this.showResults();
                } else {
                    this.reset();
                    this.state = 'running';
                }
            }

            showResults() {
                this.state = 'complete';
                const overlay = document.getElementById('overlay');
                overlay.style.display = 'flex';
                overlay.querySelector('h1').textContent = "FINAL RESULTS";
                overlay.querySelector('p').innerHTML = `BEST THROW: <span style="color:#fbbf24">${this.bestDist.toFixed(2)}m</span><br>Tournament Complete!`;
                overlay.querySelector('button').textContent = "RETRY GOLD";
                this.round = 0;
                this.attempts = [];
                this.bestDist = 0;
                document.getElementById('best-val').textContent = '0.00m';
            }

            update() {
                if(this.state === 'running') {
                    this.player.speed *= 0.97; // Slightly higher friction
                    this.offset += this.player.speed;
                    this.player.frame += this.player.speed * 0.08;
                    
                    document.getElementById('speed-fill').style.height = (this.player.speed / 15 * 100) + '%';

                    // Update Angle Meter
                    this.angleVal += 3 * this.angleDir;
                    if(this.angleVal >= 100 || this.angleVal <= 0) this.angleDir *= -1;
                    document.getElementById('angle-fill').style.height = this.angleVal + '%';

                    if(this.player.x + this.offset > this.lineX + 40) {
                        this.triggerFault();
                    }
                }

                if(this.state === 'flight') {
                    this.javelin.vy += 0.22; // Gravity
                    this.javelin.x += this.javelin.vx;
                    this.javelin.y += this.javelin.vy;
                    // Javelin points towards velocity
                    this.javelin.rot = Math.atan2(this.javelin.vy, this.javelin.vx);

                    if(this.javelin.y > 520) {
                        this.javelin.y = 520;
                        this.land();
                    }
                }
            }

            land() {
                this.state = 'result';
                const dist = Math.max(0, (this.javelin.x + this.offset - this.lineX) / 10).toFixed(2);
                document.getElementById('current-val').textContent = dist + ' m';
                this.attempts.push(parseFloat(dist));
                
                if(parseFloat(dist) > this.bestDist) {
                    this.bestDist = parseFloat(dist);
                    document.getElementById('best-val').textContent = dist + ' m';
                }

                const msg = document.getElementById('msg-box');
                msg.textContent = dist + 'm';
                msg.style.color = '#fff';
                msg.classList.add('show');

                setTimeout(() => this.nextAttempt(), 2500);
            }

            draw() {
                const ctx = this.ctx;
                ctx.clearRect(0, 0, this.width, this.height);

                // Parallax Clouds
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                for(let i=0; i<5; i++) {
                    const cx = (i * 300 - this.offset * 0.2 + 1000) % (this.width + 400) - 200;
                    ctx.beginPath(); ctx.ellipse(cx, 100 + i*20, 100, 40, 0, 0, Math.PI*2); ctx.fill();
                }

                // Background Crowd (Simplified)
                ctx.fillStyle = '#1e293b';
                ctx.fillRect(0, 400, this.width, 100);
                for(let i=0; i<this.width; i+=20) {
                    const bob = Math.sin(Date.now()/200 + i) * 5;
                    ctx.fillStyle = i % 40 === 0 ? '#334155' : '#475569';
                    ctx.beginPath(); ctx.arc(i, 410 + bob, 8, 0, Math.PI*2); ctx.fill();
                }

                // Grass
                ctx.fillStyle = varColor('--field');
                ctx.fillRect(0, 520, this.width, 80);

                // Track
                ctx.fillStyle = varColor('--track');
                ctx.fillRect(0, 480, this.width, 40);

                // Foul Line
                const lx = this.lineX - this.offset;
                ctx.fillStyle = 'white';
                ctx.fillRect(lx, 480, 15, 40);
                // Glow
                ctx.shadowBlur = 15; ctx.shadowColor = 'white';
                ctx.fillRect(lx, 480, 15, 40);
                ctx.shadowBlur = 0;

                // Distance Markers
                ctx.fillStyle = 'rgba(255,255,255,0.6)';
                ctx.font = 'bold 14px Arial';
                for(let i=0; i<5000; i+=100) {
                    const mx = lx + i;
                    if(mx > 0 && mx < this.width) {
                        ctx.fillRect(mx, 520, 3, 15);
                        ctx.fillText((i/10) + 'm', mx + 8, 545);
                    }
                }

                // Player
                if(this.state === 'running' || this.state === 'idle' || this.state === 'result') {
                    const px = this.state === 'result' ? this.player.x : this.player.x;
                    this.drawPlayer(px, this.player.y);
                }

                // Javelin
                if(this.state === 'flight' || this.state === 'result') {
                    ctx.save();
                    ctx.translate(this.javelin.x, this.javelin.y);
                    ctx.rotate(this.javelin.rot);
                    
                    // Shadow
                    ctx.save();
                    ctx.translate(0, 520 - this.javelin.y);
                    ctx.fillStyle = 'rgba(0,0,0,0.2)';
                    ctx.fillRect(-40, 0, 80, 4);
                    ctx.restore();

                    ctx.strokeStyle = '#111';
                    ctx.lineWidth = 4;
                    ctx.lineCap = 'round';
                    ctx.beginPath(); ctx.moveTo(-45, 0); ctx.lineTo(45, 0); ctx.stroke();
                    
                    ctx.fillStyle = varColor('--gold');
                    ctx.beginPath(); ctx.moveTo(45, 0); ctx.lineTo(30, -6); ctx.lineTo(30, 6); ctx.fill();
                    
                    // Grip
                    ctx.strokeStyle = '#78350f';
                    ctx.lineWidth = 5;
                    ctx.beginPath(); ctx.moveTo(-5, 0); ctx.lineTo(5, 0); ctx.stroke();
                    
                    ctx.restore();
                }
            }

            drawPlayer(x, y) {
                const ctx = this.ctx;
                const bob = Math.sin(this.player.frame) * 8;
                const runAngle = Math.sin(this.player.frame) * 0.2;

                ctx.save();
                ctx.translate(x, y + bob);
                ctx.rotate(runAngle);

                // Body
                ctx.fillStyle = '#1d4ed8';
                ctx.beginPath();
                ctx.roundRect(-15, -80, 30, 65, 10);
                ctx.fill();
                
                // Head
                ctx.fillStyle = '#ffccaa';
                ctx.beginPath(); ctx.arc(0, -95, 18, 0, Math.PI*2); ctx.fill();
                
                // Hair/Cap
                ctx.fillStyle = '#111';
                ctx.beginPath(); ctx.arc(0, -100, 18, Math.PI, 0); ctx.fill();

                // Arms
                ctx.strokeStyle = '#1d4ed8';
                ctx.lineWidth = 12;
                ctx.lineCap = 'round';
                
                // Back arm
                ctx.beginPath(); ctx.moveTo(-10, -60); ctx.lineTo(-30 + Math.cos(this.player.frame)*20, -20); ctx.stroke();
                
                // Front arm holding javelin
                ctx.save();
                ctx.translate(10, -70);
                ctx.rotate(-Math.PI/6 + Math.sin(this.player.frame)*0.1);
                ctx.strokeStyle = '#ffccaa';
                ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(40, -20); ctx.stroke();
                
                // Javelin in hand
                if(this.state === 'running' || this.state === 'idle') {
                    ctx.translate(20, -10);
                    ctx.strokeStyle = '#111';
                    ctx.lineWidth = 4;
                    ctx.beginPath(); ctx.moveTo(-50, 0); ctx.lineTo(50, 0); ctx.stroke();
                    ctx.fillStyle = varColor('--gold');
                    ctx.beginPath(); ctx.moveTo(50, 0); ctx.lineTo(35, -6); ctx.lineTo(35, 6); ctx.fill();
                }
                ctx.restore();

                // Legs
                ctx.strokeStyle = '#1e3a8a';
                ctx.lineWidth = 14;
                const l1 = Math.sin(this.player.frame) * 30;
                const l2 = Math.sin(this.player.frame + Math.PI) * 30;
                ctx.beginPath(); ctx.moveTo(-8, -20); ctx.lineTo(-8 + l1, 10); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(8, -20); ctx.lineTo(8 + l2, 10); ctx.stroke();

                ctx.restore();
            }

            loop() {
                this.update();
                this.draw();
                requestAnimationFrame(() => this.loop());
            }
        }

        function varColor(name) {
            return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        }

        let game = new Javelin();
        function startGame() {
            document.getElementById('overlay').style.display = 'none';
            game.reset();
            game.state = 'running';
        }
    </script>
</body>
</html>