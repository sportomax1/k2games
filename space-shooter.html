<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Shooter Pro</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Arial', sans-serif; color: white; }
        #ui { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); text-align: center; pointer-events: none; z-index: 10; }
        .score { font-size: 2.5rem; font-weight: bold; text-shadow: 0 0 10px #3498db; }
        .timer { font-size: 1.2rem; opacity: 0.8; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; }
        .color-card { width: 80px; height: 80px; border-radius: 10px; cursor: pointer; border: 3px solid transparent; transition: 0.2s; display: flex; align-items: center; justify-content: center; font-size: 2rem; }
        .color-card:hover { transform: scale(1.1); border-color: white; }
        .btn { padding: 15px 40px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.5rem; margin-top: 20px; text-transform: uppercase; }
        .btn:hover { background: #2980b9; transform: scale(1.05); }
        .back { position: fixed; bottom: 20px; left: 20px; color: #3498db; text-decoration: none; background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 8px; z-index: 110; }
        #score-popup { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); font-size: 1.5rem; font-weight: bold; transition: 0.5s; opacity: 0; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
</head>
<body>
    <div id="selection" class="overlay">
        <h1>üöÄ SPACE SHOOTER PRO üöÄ</h1>
        <p>Choose Ship Color to Begin</p>
        <div class="grid">
            <div class="color-card" style="background:#ffffff" onclick="start(0xffffff)">üöÄ</div>
            <div class="color-card" style="background:#ff4444" onclick="start(0xff4444)">üöÄ</div>
            <div class="color-card" style="background:#44ff44" onclick="start(0x44ff44)">üöÄ</div>
            <div class="color-card" style="background:#4444ff" onclick="start(0x4444ff)">üöÄ</div>
            <div class="color-card" style="background:#ffff44" onclick="start(0xffff44)">üöÄ</div>
            <div class="color-card" style="background:#ff44ff" onclick="start(0xff44ff)">üöÄ</div>
            <div class="color-card" style="background:#44ffff" onclick="start(0x44ffff)">üöÄ</div>
            <div class="color-card" style="background:#ffa500" onclick="start(0xffa500)">üöÄ</div>
        </div>
    </div>

    <div id="game-over" class="overlay" style="display: none;">
        <h1 style="color: #ef4444; font-size: 4rem;">MISSION FAILED</h1>
        <div style="font-size: 2rem; margin: 20px 0;">FINAL SCORE: <span id="final-score">0</span></div>
        <button class="btn" onclick="location.reload()">RESTART MISSION</button>
    </div>

    <div id="ui">
        <div class="score">Score: <span id="score">0</span></div>
        <div class="timer">Time: <span id="time">0.0</span>s</div>
    </div>
    <div id="score-popup"></div>
    <a href="index.html" class="back">‚Üê HUB</a>

    <script>
        let scene, camera, renderer, ship;
        let bullets = [], enemies = [], items = [];
        let score = 0, startTime, gameActive = false;
        let keys = {};

        function start(color) {
            document.getElementById('selection').style.display = 'none';
            init(color);
            gameActive = true;
            startTime = Date.now();
            animate();
        }

        function init(shipColor) {
            scene = new THREE.Scene();
            camera = new THREE.OrthographicCamera(window.innerWidth/-2, window.innerWidth/2, window.innerHeight/2, window.innerHeight/-2, 0.1, 1000);
            camera.position.z = 10;

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Ship
            const shape = new THREE.Shape();
            shape.moveTo(0, 30); shape.lineTo(-20, -20); shape.lineTo(20, -20);
            const geometry = new THREE.ShapeGeometry(shape);
            const material = new THREE.MeshBasicMaterial({ color: shipColor });
            ship = new THREE.Mesh(geometry, material);
            ship.position.y = -window.innerHeight/2 + 100;
            scene.add(ship);

            // Stars
            for(let i=0; i<200; i++) {
                const star = new THREE.Mesh(new THREE.CircleGeometry(1, 8), new THREE.MeshBasicMaterial({color: 0xffffff}));
                star.position.set((Math.random()-0.5)*window.innerWidth, (Math.random()-0.5)*window.innerHeight, -1);
                scene.add(star);
            }
        }

        function spawnEnemy() {
            const r = 20 + Math.random()*30;
            const enemy = new THREE.Mesh(new THREE.CircleGeometry(r, 32), new THREE.MeshBasicMaterial({color: 0xff4444}));
            enemy.position.set((Math.random()-0.5)*window.innerWidth, window.innerHeight/2 + 50, 0);
            enemy.userData = { r, type: 'enemy' };
            enemies.push(enemy);
            scene.add(enemy);
        }

        function spawnSpecial() {
            const enemy = new THREE.Mesh(new THREE.TorusGeometry(20, 5, 8, 20), new THREE.MeshBasicMaterial({color: 0x8000ff}));
            enemy.position.set((Math.random()-0.5)*window.innerWidth, window.innerHeight/2 + 50, 0);
            enemy.userData = { r: 25, type: 'balloon', hits: 0 };
            enemies.push(enemy);
            scene.add(enemy);
        }

        function shoot() {
            if(!gameActive) return;
            const b = new THREE.Mesh(new THREE.CircleGeometry(5, 16), new THREE.MeshBasicMaterial({color: 0xffff00}));
            b.position.copy(ship.position);
            b.position.y += 30;
            bullets.push(b);
            scene.add(b);
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('game-over').style.display = 'flex';
            document.getElementById('final-score').textContent = score;
        }

        function animate() {
            if(!gameActive) return;
            requestAnimationFrame(animate);

            // Movement
            if(keys['ArrowLeft'] || keys['KeyA']) ship.position.x -= 8;
            if(keys['ArrowRight'] || keys['KeyD']) ship.position.x += 8;
            if(keys['ArrowUp'] || keys['KeyW']) ship.position.y += 8;
            if(keys['ArrowDown'] || keys['KeyS']) ship.position.y -= 8;

            // Spawning
            if(Math.random() < 0.03) spawnEnemy();
            if(Math.random() < 0.01) spawnSpecial();

            // Bullets
            bullets.forEach((b, i) => {
                b.position.y += 15;
                if(b.position.y > window.innerHeight/2) { scene.remove(b); bullets.splice(i, 1); }
                
                enemies.forEach((e, ei) => {
                    if(b.position.distanceTo(e.position) < e.userData.r + 5) {
                        if(e.userData.type === 'balloon' && e.userData.hits < 1) {
                            e.userData.hits++;
                            e.material.color.set(0xffff00); // Turn to star
                            popup("+5"); score += 5;
                        } else {
                            scene.remove(e); enemies.splice(ei, 1);
                            const pts = Math.round(100/e.userData.r);
                            popup("+"+pts); score += pts;
                        }
                        scene.remove(b); bullets.splice(i, 1);
                        document.getElementById('score').textContent = score;
                    }
                });
            });

            // Enemies
            enemies.forEach((e, i) => {
                e.position.y -= 3;
                if(e.position.y < -window.innerHeight/2 - 50) { scene.remove(e); enemies.splice(i, 1); }
                if(e.position.distanceTo(ship.position) < e.userData.r + 20) {
                    gameOver();
                }
            });

            document.getElementById('time').textContent = ((Date.now() - startTime)/1000).toFixed(1);
            renderer.render(scene, camera);
        }

        function popup(txt) {
            const el = document.getElementById('score-popup');
            el.textContent = txt; el.style.opacity = 1;
            setTimeout(() => el.style.opacity = 0, 500);
        }

        window.onkeydown = e => { keys[e.code] = true; if(e.code === 'Space') shoot(); };
        window.onkeyup = e => keys[e.code] = false;
    </script>
</body>
</html>