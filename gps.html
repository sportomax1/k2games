<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GPS: Global Positioning Satellites - K2 games</title>
    <style>
        :root {
            --bg: #020617;
            --earth: #0ea5e9;
            --space: #0f172a;
            --p1: #3b82f6; /* Blue */
            --p2: #ef4444; /* Red */
            --accent: #fbbf24;
            --glass: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; user-select: none; }
        
        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        nav {
            padding: 0.8rem 1.5rem;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo { font-weight: 900; font-size: 1.2rem; background: linear-gradient(to right, #60a5fa, #34d399); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .back-link { color: #94a3b8; text-decoration: none; font-weight: bold; font-size: 0.9rem; }

        #game-layout {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
        }

        canvas {
            display: block;
            max-width: 100%;
            max-height: 70vh;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Hand / UI */
        #ui-overlay {
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 50;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--glass);
            padding: 10px 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .hand {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .satellite-card {
            width: 60px;
            height: 80px;
            background: var(--p1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.8rem;
            cursor: pointer;
            transition: 0.2s;
            border: 3px solid transparent;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .satellite-card.p2 { background: var(--p2); }
        .satellite-card.selected { transform: translateY(-10px); border-color: white; box-shadow: 0 0 20px var(--accent); }
        .satellite-card:hover { transform: scale(1.05); }

        #phase-indicator {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            color: #000;
            padding: 5px 20px;
            border-radius: 50px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
            z-index: 60;
        }

        .screen-overlay {
            position: absolute; inset: 0;
            background: rgba(2, 6, 23, 0.95);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 200; text-align: center; padding: 20px;
        }

        .btn-large {
            background: #3b82f6; color: white; border: none; padding: 1rem 3rem;
            border-radius: 50px; font-weight: 800; cursor: pointer; margin-top: 2rem;
            font-size: 1.2rem; box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        #turn-msg {
            font-size: 1.2rem; font-weight: 800; text-align: center; color: var(--accent);
        }
    </style>
</head>
<body>
    <nav>
        <div class="logo">K2 GPS</div>
        <a href="index.html" class="back-link">‚Üê HUB</a>
    </nav>

    <div id="game-layout">
        <div id="phase-indicator">PHASE 1: LAUNCH</div>
        
        <canvas id="gameCanvas"></canvas>

        <div id="ui-overlay">
            <div id="turn-msg">TAP SPINNER TO START</div>
            <div class="hand" id="player-hand">
                <!-- Cards via JS -->
            </div>
            <div class="player-info">
                <div style="color: var(--p1); font-weight: 900;">BLUE (YOU)</div>
                <div id="p1-progress" style="font-family: monospace;">ORD: 0/12</div>
            </div>
        </div>

        <div id="start-screen" class="screen-overlay">
            <h1 style="font-size: 4rem; font-style: italic; background: linear-gradient(to right, #60a5fa, #34d399); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900;">GPS</h1>
            <p style="opacity: 0.7; margin-top: 10px; max-width: 400px;">Launch your satellites into space. Be the first to arrange them from 1 to 12 in clockwise order!</p>
            <button class="btn-large" onclick="game.start()">COMMENCE MISSION</button>
        </div>

        <div id="end-screen" class="screen-overlay" style="display:none">
            <h1 id="winner-text" style="font-size: 3rem; color: var(--accent);">MISSION SUCCESSFUL!</h1>
            <p style="opacity: 0.7; margin-top: 10px;">The orbital sequence is complete.</p>
            <button class="btn-large" onclick="location.reload()">NEW MISSION</button>
        </div>
    </div>

    <script>
        class GPSGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.size = 800;
                this.canvas.width = this.size;
                this.canvas.height = this.size;

                this.earthR = 120;
                this.orbitR = 300;
                this.slots = 12;
                
                this.spinnerAngle = 0;
                this.spinnerVel = 0;
                this.targetSlot = -1;
                
                this.p1Hand = []; // 3 numbers
                this.p1Deck = []; // 12 numbers
                this.p2Hand = [];
                this.p2Deck = [];
                
                this.board = Array(12).fill(null).map(() => ({ p1: null, p2: null })); // satellite numbers
                
                this.turn = 'p1';
                this.state = 'idle'; // idle, spinning, choosing, waiting
                this.phase = 1;
                this.selectedIdx = -1;

                this.init();
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.canvas.addEventListener('click', () => this.handleCanvasClick());
                
                this.loop = this.loop.bind(this);
                requestAnimationFrame(this.loop);
            }

            resize() {
                const min = Math.min(window.innerWidth - 40, window.innerHeight * 0.6);
                this.canvas.style.width = min + 'px';
                this.canvas.style.height = min + 'px';
            }

            init() {
                // Shuffle decks
                const nums = [1,2,3,4,5,6,7,8,9,10,11,12];
                this.p1Deck = [...nums].sort(() => Math.random() - 0.5);
                this.p2Deck = [...nums].sort(() => Math.random() - 0.5);
                
                // Draw initial hands
                for(let i=0; i<3; i++) {
                    this.p1Hand.push(this.p1Deck.pop());
                    this.p2Hand.push(this.p2Deck.pop());
                }
            }

            start() {
                document.getElementById('start-screen').style.display = 'none';
                this.updateUI();
            }

            handleCanvasClick() {
                if (this.state === 'idle') {
                    this.spin();
                } else if (this.state === 'choosing' && this.selectedIdx !== -1) {
                    this.placeSatellite();
                }
            }

            spin() {
                this.state = 'spinning';
                this.spinnerVel = 0.3 + Math.random() * 0.5;
                document.getElementById('turn-msg').textContent = "SPINNING...";
            }

            placeSatellite() {
                const val = this.p1Hand[this.selectedIdx];
                let slot = this.targetSlot;
                
                // Conflict Rule: Find next open for ME
                let attempts = 0;
                while(this.board[slot].p1 !== null && attempts < 12) {
                    slot = (slot + 1) % 12;
                    attempts++;
                }
                
                if (attempts < 12) {
                    this.board[slot].p1 = val;
                    this.p1Hand.splice(this.selectedIdx, 1);
                    if (this.p1Deck.length > 0) this.p1Hand.push(this.p1Deck.pop());
                    
                    this.selectedIdx = -1;
                    this.checkWin();
                    if (this.state !== 'over') {
                        this.state = 'waiting';
                        this.updateUI();
                        setTimeout(() => this.cpuTurn(), 1000);
                    }
                }
            }

            cpuTurn() {
                const spinTarget = Math.floor(Math.random() * 12);
                const valIdx = Math.floor(Math.random() * this.p2Hand.length);
                const val = this.p2Hand[valIdx];
                
                let slot = spinTarget;
                let attempts = 0;
                while(this.board[slot].p2 !== null && attempts < 12) {
                    slot = (slot + 1) % 12;
                    attempts++;
                }
                
                if (attempts < 12) {
                    this.board[slot].p2 = val;
                    this.p2Hand.splice(valIdx, 1);
                    if (this.p2Deck.length > 0) this.p2Hand.push(this.p2Deck.pop());
                }
                
                this.checkWin();
                if (this.state !== 'over') {
                    this.state = 'idle';
                    this.updateUI();
                }
            }

            checkWin() {
                const check = (player) => {
                    const satellites = [];
                    for(let i=0; i<12; i++) {
                        const val = this.board[i][player];
                        if (val !== null) satellites.push({ val, slot: i });
                    }
                    if (satellites.length < 12) return false;
                    
                    // Check clockwise ascending order
                    // We can start from any satellite
                    for(let start=0; start<12; start++) {
                        let ordered = true;
                        for(let j=0; j<11; j++) {
                            const current = satellites[(start + j) % 12].val;
                            const next = satellites[(start + j + 1) % 12].val;
                            // Ascending logic: next must be > current OR next must be 1 if current is 12?
                            // Wait, rule: "ascending numerical order (1-12) clockwise"
                            // Means 1, 2, 3... 12. If we loop, 1 follows 12.
                            if (next !== (current % 12) + 1) {
                                ordered = false;
                                break;
                            }
                        }
                        if (ordered) return true;
                    }
                    return false;
                };

                const p1Win = check('p1');
                const p2Win = check('p2');

                if (p1Win || p2Win) {
                    this.state = 'over';
                    document.getElementById('end-screen').style.display = 'flex';
                    document.getElementById('winner-text').textContent = p1Win ? "MISSION SUCCESSFUL!" : "MISSION FAILED!";
                    document.getElementById('winner-text').style.color = p1Win ? 'var(--p1)' : 'var(--p2)';
                }
            }

            updateUI() {
                const handEl = document.getElementById('player-hand');
                handEl.innerHTML = '';
                this.p1Hand.forEach((num, i) => {
                    const card = document.createElement('div');
                    card.className = `satellite-card ${this.selectedIdx === i ? 'selected' : ''}`;
                    card.textContent = num;
                    card.onclick = () => {
                        if (this.state === 'choosing' || this.state === 'idle') {
                            this.selectedIdx = i;
                            this.updateUI();
                        }
                    };
                    handEl.appendChild(card);
                });

                const count = this.board.filter(s => s.p1 !== null).length;
                document.getElementById('p1-progress').textContent = `ORB: ${count}/12`;
                
                if (this.state === 'idle') document.getElementById('turn-msg').textContent = "TAP SPINNER TO LAUNCH";
                else if (this.state === 'choosing') document.getElementById('turn-msg').textContent = "PICK A SATELLITE";
                else if (this.state === 'waiting') document.getElementById('turn-msg').textContent = "ENEMY IS LAUNCHING...";
            }

            update() {
                if (this.state === 'spinning') {
                    this.spinnerAngle += this.spinnerVel;
                    this.spinnerVel *= 0.985;
                    if (this.spinnerVel < 0.005) {
                        this.spinnerVel = 0;
                        this.targetSlot = Math.floor(((this.spinnerAngle % (Math.PI * 2)) / (Math.PI * 2)) * 12);
                        // Normalize target slot (0 is 12 o'clock approx)
                        // Canvas coordinates: 0 is right. We want 0 to be top.
                        this.targetSlot = (12 - Math.floor(((this.spinnerAngle + Math.PI/2) % (Math.PI * 2)) / (Math.PI * 2) * 12)) % 12;
                        
                        this.state = 'choosing';
                        this.updateUI();
                    }
                }
            }

            draw() {
                const ctx = this.ctx;
                ctx.clearRect(0, 0, this.size, this.size);

                // Space
                const grad = ctx.createRadialGradient(this.size/2, this.size/2, 0, this.size/2, this.size/2, this.size/2);
                grad.addColorStop(0, '#1e293b'); grad.addColorStop(1, '#020617');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, this.size, this.size);

                // Orbit Circle
                ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                ctx.lineWidth = 2;
                ctx.beginPath(); ctx.arc(this.size/2, this.size/2, this.orbitR, 0, Math.PI*2); ctx.stroke();

                // Slots
                for(let i=0; i<12; i++) {
                    const angle = (i / 12) * Math.PI * 2 - Math.PI/2;
                    const x = this.size/2 + Math.cos(angle) * this.orbitR;
                    const y = this.size/2 + Math.sin(angle) * this.orbitR;
                    
                    // Highlight target
                    if (this.state === 'choosing' && i === this.targetSlot) {
                        ctx.fillStyle = 'rgba(251, 191, 36, 0.3)';
                        ctx.beginPath(); ctx.arc(x, y, 40, 0, Math.PI*2); ctx.fill();
                    }

                    ctx.fillStyle = 'rgba(255,255,255,0.05)';
                    ctx.beginPath(); ctx.arc(x, y, 30, 0, Math.PI*2); ctx.fill();
                    
                    // Slot label
                    ctx.fillStyle = 'rgba(255,255,255,0.3)';
                    ctx.font = '12px Arial'; ctx.textAlign = 'center';
                    ctx.fillText(i+1, x, y+45);

                    // Satellites
                    const s = this.board[i];
                    if (s.p1 !== null) {
                        ctx.fillStyle = varColor('--p1');
                        ctx.beginPath(); ctx.arc(x - 15, y, 15, 0, Math.PI*2); ctx.fill();
                        ctx.fillStyle = 'white'; ctx.font = 'bold 14px Arial'; ctx.fillText(s.p1, x - 15, y + 5);
                    }
                    if (s.p2 !== null) {
                        ctx.fillStyle = varColor('--p2');
                        ctx.beginPath(); ctx.arc(x + 15, y, 15, 0, Math.PI*2); ctx.fill();
                        ctx.fillStyle = 'white'; ctx.font = 'bold 14px Arial'; ctx.fillText(s.p2, x + 15, y + 5);
                    }
                }

                // Earth
                ctx.save();
                ctx.translate(this.size/2, this.size/2);
                ctx.rotate(Date.now() / 5000);
                ctx.font = '120px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText('üåç', 0, 0);
                ctx.restore();

                // Spinner (Rocket)
                ctx.save();
                ctx.translate(this.size/2, this.size/2);
                ctx.rotate(this.spinnerAngle);
                ctx.font = '60px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText('üöÄ', 0, -180);
                // Flame
                if (this.state === 'spinning') {
                    ctx.fillStyle = '#f97316';
                    ctx.beginPath(); ctx.moveTo(-10, -150); ctx.lineTo(10, -150); ctx.lineTo(0, -120 - Math.random()*20); ctx.fill();
                }
                ctx.restore();
            }

            loop() {
                this.update();
                this.draw();
                requestAnimationFrame(this.loop);
            }
        }

        function varColor(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }
        const game = new GPSGame();
    </script>
</body>
</html>
