<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Skee-Ball Pro - K2 games</title>
    <style>
        :root {
            --primary: #ef4444;
            --bg: #0f172a;
            --panel: #1e293b;
            --text: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', system-ui, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }

        #ui {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            z-index: 100;
        }

        .stat-card {
            background: var(--panel);
            padding: 10px 20px;
            border-radius: 12px;
            border: 2px solid var(--primary);
            text-align: center;
            min-width: 100px;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
        }

        .stat-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.7; }
        .stat-val { font-size: 1.5rem; font-weight: 900; color: #fff; }

        #game-area {
            position: relative;
            flex: 1;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        canvas {
            background: #000;
            border-radius: 15px;
            max-width: 100%;
            max-height: 100%;
            cursor: crosshair;
        }

        .instructions {
            position: absolute;
            bottom: 20px;
            font-size: 0.8rem;
            opacity: 0.4;
            pointer-events: none;
            text-align: center;
        }

        .back-link {
            position: fixed; top: 20px; left: 20px; color: white; text-decoration: none;
            background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 10px;
            font-weight: bold; z-index: 200;
        }

        #overlay {
            position: absolute; inset: 0;
            background: rgba(15, 23, 42, 0.9);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 500; text-align: center;
        }

        .btn {
            background: var(--primary); color: white; border: none; padding: 12px 30px;
            border-radius: 50px; font-weight: 800; cursor: pointer; margin-top: 20px;
            transition: transform 0.2s;
        }
        .btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← HUB</a>

    <div id="ui">
        <div class="stat-card">
            <div class="stat-label">Score</div>
            <div id="score-val" class="stat-val">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Balls</div>
            <div id="balls-val" class="stat-val">9</div>
        </div>
    </div>

    <div id="game-area">
        <canvas id="gameCanvas"></canvas>
        <div class="instructions">SWIPE UP TO FLICK BALL • DRAG TO AIM</div>
        
        <div id="overlay">
            <h1 id="overlay-title" style="font-size: 3rem; color: var(--primary);">GAME OVER</h1>
            <p id="overlay-msg" style="font-size: 1.2rem; margin-top: 10px;">Final Score: 0</p>
            <button class="btn" onclick="resetGame()">PLAY AGAIN</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const W = 450;
        const H = 700;
        canvas.width = W;
        canvas.height = H;

        let score = 0;
        let ballsLeft = 9;
        let ball = { x: W/2, y: H-80, z: 0, vx: 0, vy: 0, vz: 0, active: false, r: 18, rolling: true };
        let holes = [
            { x: W/2, y: 100, r: 22, val: 100, color: '#f0f' },
            { x: W/2 - 90, y: 160, r: 25, val: 50, color: '#0ff' },
            { x: W/2 + 90, y: 160, r: 25, val: 50, color: '#0ff' },
            { x: W/2, y: 200, r: 30, val: 40, color: '#0f0' },
            { x: W/2, y: 300, r: 35, val: 30, color: '#ff0' },
            { x: W/2, y: 400, r: 40, val: 20, color: '#f80' },
            { x: W/2, y: 500, r: 45, val: 10, color: '#f00' }
        ];

        const RAMP_Y = 580; // Where the jump ramp begins

        let dragData = null;
        let isGameOver = false;

        function resetBall() {
            ball.active = false;
            ball.rolling = true;
            ball.x = W/2;
            ball.y = H-80;
            ball.z = 0;
            ball.vx = 0; ball.vy = 0; ball.vz = 0;
        }

        function resetGame() {
            score = 0; ballsLeft = 9; isGameOver = false;
            document.getElementById('score-val').textContent = '0';
            document.getElementById('balls-val').textContent = '9';
            document.getElementById('overlay').style.display = 'none';
            resetBall();
        }

        function launch(vx, vy) {
            if (ball.active || isGameOver) return;
            ball.active = true;
            ball.rolling = true;
            ball.vx = vx * 0.12;
            ball.vy = vy * 0.18;
            ball.vz = 0; // Starts rolling
        }

        // Input Logic
        function handleStart(x, y) {
            if (ball.active || isGameOver) return;
            const rect = canvas.getBoundingClientRect();
            const sx = (x - rect.left) * (W / rect.width);
            const sy = (y - rect.top) * (H / rect.height);
            dragData = { x: sx, y: sy, time: Date.now() };
        }

        function handleMove(x, y) {
            if (!dragData || ball.active) return;
            const rect = canvas.getBoundingClientRect();
            const sx = (x - rect.left) * (W / rect.width);
            ball.x = Math.max(50, Math.min(W-50, sx));
        }

        function handleEnd(x, y) {
            if (!dragData || ball.active) return;
            const rect = canvas.getBoundingClientRect();
            const ex = (x - rect.left) * (W / rect.width);
            const ey = (y - rect.top) * (H / rect.height);
            const dx = ex - dragData.x;
            const dy = ey - dragData.y;
            const dt = Date.now() - dragData.time;

            if (dy < -30 && dt < 400) {
                launch(dx, dy);
            }
            dragData = null;
        }

        canvas.addEventListener('mousedown', e => handleStart(e.clientX, e.clientY));
        window.addEventListener('mousemove', e => handleMove(e.clientX, e.clientY));
        window.addEventListener('mouseup', e => handleEnd(e.clientX, e.clientY));

        canvas.addEventListener('touchstart', e => {
            const t = e.touches[0];
            handleStart(t.clientX, t.clientY);
            e.preventDefault();
        }, {passive: false});
        canvas.addEventListener('touchmove', e => {
            const t = e.touches[0];
            handleMove(t.clientX, t.clientY);
            e.preventDefault();
        }, {passive: false});
        canvas.addEventListener('touchend', e => {
            const t = e.changedTouches[0];
            handleEnd(t.clientX, t.clientY);
            e.preventDefault();
        }, {passive: false});

        function update() {
            if (ball.active) {
                ball.x += ball.vx;
                ball.y += ball.vy;
                ball.z += ball.vz;

                // Physics
                ball.vx *= 0.99;
                ball.vy *= 0.99;
                
                if (ball.rolling) {
                    if (ball.y < RAMP_Y) {
                        // HIT THE JUMP RAMP!
                        ball.rolling = false;
                        ball.vz = Math.abs(ball.vy) * 0.8; // Launch into air
                    }
                } else {
                    ball.vz *= 0.985;
                    ball.vz -= 0.25; // Gravity
                }

                // Check collisions with holes
                if (!ball.rolling && ball.z > 20) {
                    for(let h of holes) {
                        const dist = Math.hypot(ball.x - h.x, ball.y - h.y);
                        if (dist < h.r) {
                            score += h.val;
                            resolveBall();
                            return;
                        }
                    }
                }

                if (ball.y < 20 || (ball.z < -5 && !ball.rolling) || ball.x < 0 || ball.x > W) {
                    resolveBall();
                }
            }
        }

        function resolveBall() {
            ballsLeft--;
            document.getElementById('score-val').textContent = score;
            document.getElementById('balls-val').textContent = ballsLeft;
            resetBall();
            if (ballsLeft <= 0) {
                isGameOver = true;
                document.getElementById('overlay').style.display = 'flex';
                document.getElementById('overlay-msg').textContent = `Final Score: ${score}`;
            }
        }

        function draw() {
            ctx.clearRect(0, 0, W, H);

            // Draw Target Board (Perspective)
            const boardGrad = ctx.createLinearGradient(0, 0, 0, RAMP_Y);
            boardGrad.addColorStop(0, '#1e293b');
            boardGrad.addColorStop(1, '#0f172a');
            ctx.fillStyle = boardGrad;
            ctx.beginPath();
            ctx.moveTo(40, 50); ctx.lineTo(W-40, 50);
            ctx.lineTo(W-10, RAMP_Y); ctx.lineTo(10, RAMP_Y);
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = '#334155'; ctx.lineWidth = 2; ctx.stroke();

            // Draw Leadup Lane
            const laneGrad = ctx.createLinearGradient(0, RAMP_Y, 0, H);
            laneGrad.addColorStop(0, '#334155');
            laneGrad.addColorStop(1, '#1e293b');
            ctx.fillStyle = laneGrad;
            ctx.fillRect(0, RAMP_Y, W, H - RAMP_Y);
            
            // Lane Lines
            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            for(let i=0; i<=W; i+=50) {
                ctx.beginPath(); ctx.moveTo(i, RAMP_Y); ctx.lineTo(i, H); ctx.stroke();
            }

            // Draw Jump Ramp (The Kick)
            ctx.fillStyle = '#475569';
            ctx.fillRect(0, RAMP_Y - 10, W, 15);
            const rampHighlight = ctx.createLinearGradient(0, RAMP_Y-10, 0, RAMP_Y+5);
            rampHighlight.addColorStop(0, 'rgba(255,255,255,0.2)');
            rampHighlight.addColorStop(1, 'transparent');
            ctx.fillStyle = rampHighlight;
            ctx.fillRect(0, RAMP_Y - 10, W, 15);

            // Draw Holes
            holes.forEach(h => {
                ctx.save();
                ctx.shadowBlur = 15; ctx.shadowColor = h.color;
                ctx.fillStyle = '#000';
                ctx.beginPath(); ctx.arc(h.x, h.y, h.r, 0, Math.PI*2); ctx.fill();
                ctx.strokeStyle = h.color; ctx.lineWidth = 4; ctx.stroke();
                
                ctx.fillStyle = h.color;
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(h.val, h.x, h.y);
                ctx.restore();
            });

            // Draw Ball
            const scale = ball.rolling ? 1 : Math.max(0.4, 1 - (ball.z * 0.004));
            const r = ball.r * scale;
            
            // Shadow (only if in air)
            if (!ball.rolling) {
                ctx.fillStyle = 'rgba(0,0,0,0.4)';
                ctx.beginPath(); ctx.ellipse(ball.x, ball.y + r + ball.z/5, r, r/3, 0, 0, Math.PI*2); ctx.fill();
            } else {
                ctx.fillStyle = 'rgba(0,0,0,0.2)';
                ctx.beginPath(); ctx.ellipse(ball.x, ball.y + r/2, r, r/4, 0, 0, Math.PI*2); ctx.fill();
            }

            // 3D Ball
            ctx.save();
            const bGrad = ctx.createRadialGradient(ball.x - r/3, ball.y - ball.z/2 - r/3, r/5, ball.x, ball.y - ball.z/2, r);
            bGrad.addColorStop(0, '#fff');
            bGrad.addColorStop(1, '#64748b');
            ctx.fillStyle = bGrad;
            ctx.beginPath(); ctx.arc(ball.x, ball.y - ball.z/2, r, 0, Math.PI*2); ctx.fill();
            ctx.restore();

            update();
            requestAnimationFrame(draw);
        }

        draw();

        draw();
    </script>
</body>
</html>
