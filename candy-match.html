<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candy Match</title>
    <style>
        body { font-family: sans-serif; background: #fdf2f8; color: #86198f; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .grid { display: grid; grid-template-columns: repeat(8, 50px); grid-template-rows: repeat(8, 50px); gap: 4px; background: #f5d0fe; padding: 10px; border-radius: 12px; border: 4px solid #d946ef; }
        .candy { width: 50px; height: 50px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 2rem; transition: transform 0.2s, background 0.2s; user-select: none; }
        .candy:hover { transform: scale(1.1); }
        .selected { outline: 4px solid white; outline-offset: -4px; transform: scale(1.1); z-index: 10; }
        .ui { margin-bottom: 20px; text-align: center; }
        .score { font-size: 2rem; font-weight: bold; }
        .back { position: absolute; bottom: 20px; left: 20px; color: #d946ef; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <div class="ui">
        <div class="score">Score: <span id="score">0</span></div>
    </div>
    <div id="grid" class="grid"></div>
    <a href="index.html" class="back">‚Üê HUB</a>

    <script>
        const symbols = ['üçé','üçá','üçä','üçã','ü´ê','ü•ù'];
        const width = 8;
        let grid = [];
        let score = 0;
        let selected = null;

        function init() {
            const gridEl = document.getElementById('grid');
            for(let i=0; i<width*width; i++) {
                const candy = document.createElement('div');
                candy.className = 'candy';
                candy.id = i;
                const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                candy.textContent = randomSymbol;
                candy.onclick = () => handleSelect(i);
                gridEl.appendChild(candy);
                grid.push(randomSymbol);
            }
            while(checkMatches()) {
                refillGrid();
            }
            score = 0;
            document.getElementById('score').textContent = score;
        }

        function handleSelect(i) {
            const el = document.getElementById(i);
            if(!selected) {
                selected = i;
                el.classList.add('selected');
            } else {
                const isAdjacent = checkAdjacent(selected, i);
                if(isAdjacent) {
                    swap(selected, i);
                    if(!checkMatches()) {
                        setTimeout(() => swap(selected, i), 300);
                    }
                }
                document.getElementById(selected).classList.remove('selected');
                selected = null;
            }
        }

        function checkAdjacent(i1, i2) {
            const r1 = Math.floor(i1/width), c1 = i1%width;
            const r2 = Math.floor(i2/width), c2 = i2%width;
            return (Math.abs(r1-r2) === 1 && c1 === c2) || (Math.abs(c1-c2) === 1 && r1 === r2);
        }

        function swap(i1, i2) {
            const temp = grid[i1];
            grid[i1] = grid[i2];
            grid[i2] = temp;
            document.getElementById(i1).textContent = grid[i1];
            document.getElementById(i2).textContent = grid[i2];
            processTurn();
        }

        function processTurn() {
            if(checkMatches()) {
                setTimeout(() => {
                    refillGrid();
                    processTurn();
                }, 400);
            }
        }

        function checkMatches() {
            let matched = false;
            let toClear = new Set();

            // Horizontal
            for(let r=0; r<width; r++) {
                for(let c=0; c<width-2; c++) {
                    let i = r*width+c;
                    if(grid[i] && grid[i] === grid[i+1] && grid[i] === grid[i+2]) {
                        toClear.add(i); toClear.add(i+1); toClear.add(i+2);
                        matched = true;
                    }
                }
            }
            // Vertical
            for(let c=0; c<width; c++) {
                for(let r=0; r<width-2; r++) {
                    let i = r*width+c;
                    if(grid[i] && grid[i] === grid[i+width] && grid[i] === grid[i+width*2]) {
                        toClear.add(i); toClear.add(i+width); toClear.add(i+width*2);
                        matched = true;
                    }
                }
            }

            if(matched) {
                score += toClear.size * 10;
                document.getElementById('score').textContent = score;
                toClear.forEach(i => grid[i] = null);
                updateUI();
            }
            return matched;
        }

        function refillGrid() {
            for(let c=0; c<width; c++) {
                let empty = 0;
                for(let r=width-1; r>=0; r--) {
                    let i = r*width+c;
                    if(grid[i] === null) empty++;
                    else if(empty > 0) {
                        grid[i+empty*width] = grid[i];
                        grid[i] = null;
                    }
                }
                for(let r=0; r<empty; r++) {
                    grid[r*width+c] = symbols[Math.floor(Math.random()*symbols.length)];
                }
            }
            updateUI();
        }

        function updateUI() {
            grid.forEach((symbol, i) => {
                const el = document.getElementById(i);
                el.textContent = symbol || '';
                el.style.opacity = symbol ? 1 : 0;
            });
        }

        init();
    </script>
</body>
</html>
