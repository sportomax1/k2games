<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Tile Tapper - K2 games</title>
    <style>
        :root {
            --bg: #020617;
            --primary: #00f2ff;
            --accent: #ff007a;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; user-select: none; }
        
        body {
            background-color: var(--bg);
            color: #fff;
            font-family: 'Segoe UI', system-ui, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        nav {
            height: 60px;
            padding: 0 1.5rem;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 1px solid var(--border);
        }

        .logo { font-weight: 900; font-size: 1.2rem; color: var(--primary); letter-spacing: -0.5px; }
        .back-link { color: #94a3b8; text-decoration: none; font-size: 0.8rem; font-weight: bold; }

        #game-container {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(to bottom, #020617, #1e1b4b);
        }

        canvas {
            background: rgba(0,0,0,0.5);
            box-shadow: 0 0 50px rgba(0, 242, 255, 0.1);
            border-left: 2px solid var(--border);
            border-right: 2px solid var(--border);
            max-width: 100%;
            height: 100%;
        }

        /* HUD Layer */
        #hud {
            position: absolute;
            top: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            pointer-events: none;
            z-index: 50;
        }

        .score-box {
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(12px);
            padding: 10px 30px;
            border-radius: 50px;
            border: 1px solid var(--border);
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .score-val { font-size: 2.5rem; font-weight: 900; color: var(--primary); font-family: monospace; text-shadow: 0 0 15px var(--primary); }
        .score-label { font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; opacity: 0.7; }

        /* Overlays */
        .screen-overlay {
            position: absolute; inset: 0;
            background: rgba(2, 6, 23, 0.95);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 200; text-align: center; padding: 20px;
        }

        .btn-large {
            background: var(--primary); color: #000; border: none; padding: 1rem 3rem;
            border-radius: 50px; font-weight: 800; cursor: pointer; margin-top: 2rem;
            font-size: 1.2rem; box-shadow: 0 10px 25px rgba(0, 242, 255, 0.4);
        }

        .hint { margin-top: 15px; opacity: 0.5; font-size: 0.8rem; letter-spacing: 1px; }

        @media (max-width: 600px) {
            .score-val { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="logo">NEON TAPPER</div>
        <a href="index.html" class="back-link">‚Üê EXIT HUB</a>
    </nav>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="hud">
            <div class="score-box">
                <div class="score-label">Score</div>
                <div id="score-val" class="score-val">0</div>
            </div>
        </div>

        <!-- Overlays -->
        <div id="start-screen" class="screen-overlay">
            <h1 style="font-size: 3.5rem; font-style: italic; color: var(--primary); font-weight: 900;">NEON TAPPER</h1>
            <p style="opacity: 0.7; margin-top: 10px;">Tap the neon tiles as they hit the strike zone.</p>
            <button class="btn-large" onclick="game.start()">START RHYTHM</button>
            <div class="hint">KEYS [1] [2] [3] [4] OR TAP COLUMNS</div>
        </div>

        <div id="win-screen" class="screen-overlay" style="display:none">
            <h1 style="font-size: 3.5rem; color: var(--accent);">STRIKE OUT!</h1>
            <div id="final-score" style="font-size: 2rem; font-weight: 900; margin: 10px 0;">Score: 124</div>
            <button class="btn-large" onclick="location.reload()">RETRY</button>
        </div>
    </div>

    <script>
        class NeonTapper {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.width = 400;
                this.height = 800;
                this.canvas.width = this.width;
                this.canvas.height = this.height;

                this.playing = false;
                this.score = 0;
                this.speed = 5;
                this.tiles = [];
                this.spawnTimer = 0;
                this.spawnRate = 60; // frames
                
                this.particles = [];
                this.strikeZoneY = this.height - 150;
                this.strikeZoneH = 100;
                
                this.touches = Array(4).fill(false);
                
                this.init();
            }

            init() {
                window.onkeydown = (e) => {
                    if (e.key === '1') this.tap(0);
                    if (e.key === '2') this.tap(1);
                    if (e.key === '3') this.tap(2);
                    if (e.key === '4') this.tap(3);
                };

                const handleInteraction = (e) => {
                    if (!this.playing) return;
                    e.preventDefault();
                    const rect = this.canvas.getBoundingClientRect();
                    const currentTouches = e.touches || [e];
                    
                    for (let i = 0; i < currentTouches.length; i++) {
                        const t = currentTouches[i];
                        const x = (t.clientX - rect.left) * (this.width / rect.width);
                        const col = Math.floor(x / (this.width / 4));
                        if (col >= 0 && col < 4) this.tap(col);
                    }
                };

                this.canvas.addEventListener('mousedown', handleInteraction);
                this.canvas.addEventListener('touchstart', handleInteraction, {passive: false});

                this.loop = this.loop.bind(this);
                requestAnimationFrame(this.loop);
            }

            start() {
                this.playing = true;
                this.score = 0;
                this.speed = 6;
                this.tiles = [];
                document.getElementById('start-screen').style.display = 'none';
            }

            tap(col) {
                if (!this.playing) return;

                // Visual feedback
                this.touches[col] = true;
                setTimeout(() => this.touches[col] = false, 100);

                // Check hit
                let hit = false;
                for (let i = 0; i < this.tiles.length; i++) {
                    const t = this.tiles[i];
                    if (t.col === col && t.y > this.strikeZoneY - 50 && t.y < this.strikeZoneY + this.strikeZoneH) {
                        this.tiles.splice(i, 1);
                        this.score++;
                        this.speed += 0.05;
                        this.spawnRate = Math.max(20, 60 - (this.score / 10));
                        document.getElementById('score-val').textContent = this.score;
                        this.spawnHitEffect(col * 100 + 50, this.strikeZoneY + 50);
                        hit = true;
                        break;
                    }
                }

                if (!hit) {
                    // Penalty? In simple piano tiles, missed tap = game over
                    this.gameOver();
                }
            }

            spawnHitEffect(x, y) {
                for(let i=0; i<15; i++) {
                    this.particles.push({
                        x, y,
                        vx: (Math.random()-0.5)*20,
                        vy: (Math.random()-0.5)*20,
                        life: 1.0,
                        color: Math.random() > 0.5 ? 'var(--primary)' : 'var(--accent)'
                    });
                }
            }

            update() {
                if (!this.playing) return;

                this.spawnTimer++;
                if (this.spawnTimer >= this.spawnRate) {
                    this.spawnTimer = 0;
                    this.tiles.push({ col: Math.floor(Math.random() * 4), y: -150 });
                }

                for (let i = this.tiles.length - 1; i >= 0; i--) {
                    this.tiles[i].y += this.speed;
                    if (this.tiles[i].y > this.height) {
                        this.gameOver();
                    }
                }

                // Particles
                this.particles.forEach((p, i) => {
                    p.x += p.vx; p.y += p.vy; p.life -= 0.04;
                    if (p.life <= 0) this.particles.splice(i, 1);
                });
            }

            gameOver() {
                this.playing = false;
                document.getElementById('win-screen').style.display = 'flex';
                document.getElementById('final-score').textContent = "Final Score: " + this.score;
            }

            draw() {
                const ctx = this.ctx;
                ctx.clearRect(0, 0, this.width, this.height);

                // Grid Lines
                ctx.strokeStyle = 'rgba(255,255,255,0.05)';
                ctx.lineWidth = 2;
                for(let i=1; i<4; i++) {
                    ctx.beginPath(); ctx.moveTo(i*100, 0); ctx.lineTo(i*100, this.height); ctx.stroke();
                }

                // Strike Zone
                ctx.fillStyle = 'rgba(0, 242, 255, 0.05)';
                ctx.fillRect(0, this.strikeZoneY, this.width, this.strikeZoneH);
                ctx.strokeStyle = 'var(--primary)';
                ctx.setLineDash([5, 5]);
                ctx.beginPath(); ctx.moveTo(0, this.strikeZoneY); ctx.lineTo(this.width, this.strikeZoneY); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0, this.strikeZoneY + this.strikeZoneH); ctx.lineTo(this.width, this.strikeZoneY + this.strikeZoneH); ctx.stroke();
                ctx.setLineDash([]);

                // Touches feedback
                this.touches.forEach((t, i) => {
                    if (t) {
                        const grad = ctx.createLinearGradient(0, this.height, 0, this.strikeZoneY);
                        grad.addColorStop(0, 'rgba(0, 242, 255, 0.2)');
                        grad.addColorStop(1, 'transparent');
                        ctx.fillStyle = grad;
                        ctx.fillRect(i*100, 0, 100, this.height);
                    }
                });

                // Tiles
                this.tiles.forEach(t => {
                    ctx.save();
                    ctx.shadowBlur = 15; ctx.shadowColor = 'var(--primary)';
                    ctx.fillStyle = 'var(--primary)';
                    ctx.beginPath();
                    ctx.roundRect(t.col * 100 + 10, t.y, 80, 120, 10);
                    ctx.fill();
                    
                    // Shine
                    ctx.fillStyle = 'rgba(255,255,255,0.3)';
                    ctx.fillRect(t.col * 100 + 15, t.y + 10, 70, 5);
                    ctx.restore();
                });

                // Particles
                this.particles.forEach(p => {
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI*2); ctx.fill();
                });
                ctx.globalAlpha = 1;
            }

            loop() {
                this.update();
                this.draw();
                requestAnimationFrame(this.loop);
            }
        }

        const game = new NeonTapper();
    </script>
</body>
</html>
