<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Adventure Quest: Elite - K2 games</title>
    <style>
        :root {
            --sky: #87ceeb;
            --grass: #2ecc71;
            --dirt: #8b4513;
            --accent: #f1c40f;
            --danger: #e74c3c;
            --text: #ffffff;
            --panel: rgba(15, 23, 42, 0.85);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; user-select: none; }
        
        body {
            background-color: #1a1a2e;
            color: var(--text);
            font-family: 'Segoe UI', system-ui, sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 1100px;
            height: 650px;
            background: linear-gradient(to bottom, #38bdf8, #bae6fd);
            border-radius: 24px;
            border: 8px solid #333;
            box-shadow: 0 30px 60px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* UI Overlay */
        #hud {
            position: absolute;
            top: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 30px;
            pointer-events: none;
            z-index: 100;
        }

        .hearts { display: flex; gap: 8px; font-size: 1.5rem; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
        .score-card {
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(12px);
            padding: 8px 25px;
            border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.1);
            font-weight: 900;
            color: var(--accent);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Control Hints */
        #controls-hint {
            position: absolute;
            top: 80px;
            left: 30px;
            background: rgba(0,0,0,0.4);
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            color: rgba(255,255,255,0.7);
            z-index: 90;
            pointer-events: none;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Screen States */
        .screen {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(12px);
        }

        h1 { font-size: 3.5rem; color: var(--accent); font-style: italic; margin-bottom: 15px; text-shadow: 0 0 30px rgba(241, 196, 15, 0.4); font-weight: 900; letter-spacing: -2px; }
        
        .char-grid {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .char-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
            width: 130px;
        }
        .char-card:hover { transform: translateY(-10px); border-color: #fff; background: rgba(255,255,255,0.1); }
        .char-card.selected { border-color: var(--accent); background: rgba(241, 196, 15, 0.15); box-shadow: 0 0 30px rgba(241, 196, 15, 0.3); }
        .char-icon { font-size: 4rem; margin-bottom: 10px; display: block; }
        .char-name { font-weight: 800; font-size: 1.1rem; letter-spacing: 1px; }

        .btn {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 15px 50px;
            border-radius: 50px;
            font-weight: 900;
            font-size: 1.3rem;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            text-transform: uppercase;
        }
        .btn:hover { transform: scale(1.05); background: white; }

        /* Mobile Controls */
        #mobile-controls {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            padding: 0 30px;
            display: none;
            justify-content: space-between;
            align-items: flex-end;
            z-index: 200;
            pointer-events: none;
        }

        @media (max-width: 900px) { #mobile-controls { display: flex; } }

        .move-btns { display: flex; gap: 15px; pointer-events: auto; }
        .circle-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(8px);
            border: 2px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: 900;
        }
        .circle-btn:active { background: white; color: #000; transform: scale(0.9); }

        .jump-btn { width: 90px; height: 90px; background: var(--panel); border-color: var(--accent); color: var(--accent); pointer-events: auto; }

        .back-link {
            position: fixed; top: 20px; right: 20px; color: white; text-decoration: none;
            background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 12px; z-index: 1100;
            font-weight: bold; backdrop-filter: blur(10px); font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê HUB</a>

    <div id="game-container">
        <div id="hud" style="display: none;">
            <div class="hearts" id="heart-container">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            <div class="score-card">üíé <span id="score-val">0</span></div>
        </div>

        <div id="controls-hint" style="display: none;">
            <span class="desktop-hint">WASD / Arrows to Move ‚Ä¢ Space to Jump / Grab Rope</span>
            <span class="mobile-hint" style="display:none">Use On-Screen Buttons</span>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div id="mobile-controls">
            <div class="move-btns">
                <div class="circle-btn" id="btn-left">‚Üê</div>
                <div class="circle-btn" id="btn-right">‚Üí</div>
            </div>
            <div class="circle-btn jump-btn" id="btn-jump">JUMP</div>
        </div>

        <div id="char-screen" class="screen">
            <h1>ADVENTURE QUEST</h1>
            <div class="char-grid">
                <div class="char-card selected" onclick="app.selectChar(0, this)">
                    <span class="char-icon">üßë‚ÄçüöÄ</span>
                    <div class="char-name">ASTRO</div>
                </div>
                <div class="char-card" onclick="app.selectChar(1, this)">
                    <span class="char-icon">ü•∑</span>
                    <div class="char-name">NINJA</div>
                </div>
                <div class="char-card" onclick="app.selectChar(2, this)">
                    <span class="char-icon">ü§†</span>
                    <div class="char-name">CODY</div>
                </div>
            </div>
            <button class="btn" onclick="app.startGame()">Begin Quest</button>
        </div>

        <div id="game-over" class="screen" style="display: none;">
            <h1 id="over-title" style="color: var(--danger)">GAME OVER</h1>
            <p id="final-stats" style="margin-bottom: 30px; font-size: 1.2rem; font-weight: 600; opacity: 0.8;"></p>
            <button class="btn" onclick="location.reload()">RETRY QUEST</button>
        </div>
    </div>

    <script>
        const CHARS = ['üßë‚ÄçüöÄ', 'ü•∑', 'ü§†'];
        
        class AdventureGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.width = 1100;
                this.height = 650;
                this.canvas.width = this.width;
                this.canvas.height = this.height;

                this.state = 'menu';
                this.charIdx = 0;
                this.score = 0;
                this.lives = 3;
                this.invuln = 0;
                
                this.player = {
                    x: 150, y: 400, w: 50, h: 75,
                    vx: 0, vy: 0,
                    grounded: false,
                    climbing: false,
                    swinging: null, 
                    dir: 1,
                    anim: 0
                };

                this.cameraX = 0;
                this.bgLayers = [];
                this.platforms = [];
                this.ladders = [];
                this.ropes = [];
                this.collectibles = [];
                this.enemies = [];
                
                this.keys = {};
                this.setupControls();
                this.generateWorld();
                this.loop();
            }

            setupControls() {
                window.onkeydown = (e) => this.keys[e.code] = true;
                window.onkeyup = (e) => this.keys[e.code] = false;

                const left = document.getElementById('btn-left');
                const right = document.getElementById('btn-right');
                const jump = document.getElementById('btn-jump');

                const handleJump = () => {
                    if (this.state !== 'playing') return;
                    this.keys['Space'] = true;
                    // Auto-release after a frame
                    setTimeout(() => this.keys['Space'] = false, 50);
                };

                left.ontouchstart = (e) => { e.preventDefault(); this.keys['KeyA'] = true; };
                left.ontouchend = () => this.keys['KeyA'] = false;
                right.ontouchstart = (e) => { e.preventDefault(); this.keys['KeyD'] = true; };
                right.ontouchend = () => this.keys['KeyD'] = false;
                jump.ontouchstart = (e) => { e.preventDefault(); handleJump(); };

                if ('ontouchstart' in window) {
                    document.querySelector('.desktop-hint').style.display = 'none';
                    document.querySelector('.mobile-hint').style.display = 'inline';
                }
            }

            selectChar(idx, el) {
                this.charIdx = idx;
                document.querySelectorAll('.char-card').forEach(c => c.classList.remove('selected'));
                el.classList.add('selected');
            }

            startGame() {
                document.getElementById('char-screen').style.display = 'none';
                document.getElementById('hud').style.display = 'flex';
                document.getElementById('controls-hint').style.display = 'block';
                this.state = 'playing';
            }

            generateWorld() {
                // Ground Sections
                this.platforms.push({ x: 0, y: 580, w: 1500, h: 70, type: 'grass' });
                this.platforms.push({ x: 1700, y: 580, w: 2000, h: 70, type: 'grass' });
                this.platforms.push({ x: 4000, y: 580, w: 3000, h: 70, type: 'dirt' });
                
                // Platforms
                this.platforms.push({ x: 400, y: 420, w: 250, h: 25, type: 'wood' });
                this.platforms.push({ x: 750, y: 300, w: 200, h: 25, type: 'wood' });
                
                // Ladders
                this.ladders.push({ x: 650, y: 300, w: 50, h: 280 });
                this.ladders.push({ x: 2200, y: 200, w: 50, h: 380 });
                
                // Ropes (Swinging)
                this.ropes.push({ x: 1600, y: 50, length: 300, angle: 0 });
                this.ropes.push({ x: 2500, y: 50, length: 250, angle: 0 });
                this.ropes.push({ x: 3200, y: 50, length: 350, angle: 0 });
                
                // Collectibles
                for(let i=0; i<100; i++) {
                    this.collectibles.push({
                        x: 500 + i * 150 + Math.random()*100,
                        y: 200 + Math.random()*300,
                        type: Math.random() < 0.1 ? 'heart' : 'gem',
                        collected: false
                    });
                }

                // Enemies
                for(let i=0; i<15; i++) {
                    this.enemies.push({
                        x: 1200 + i * 700,
                        y: 530,
                        vx: -2.5,
                        range: 250,
                        startX: 1200 + i * 700,
                        type: Math.random() < 0.5 ? 'slime' : 'spike'
                    });
                }

                // Parallax Bg
                for(let i=0; i<15; i++) {
                    this.bgLayers.push({
                        x: i * 800,
                        y: 100 + Math.random()*200,
                        w: 200 + Math.random()*200,
                        depth: 0.2 + Math.random()*0.5
                    });
                }
            }

            update() {
                if (this.state !== 'playing') return;

                const p = this.player;
                const jumpKey = this.keys['ArrowUp'] || this.keys['KeyW'] || this.keys['Space'];
                
                // --- MOVEMENT ---
                if (!p.swinging) {
                    if (this.keys['ArrowLeft'] || this.keys['KeyA']) {
                        p.vx = -6; p.dir = -1;
                    } else if (this.keys['ArrowRight'] || this.keys['KeyD']) {
                        p.vx = 6; p.dir = 1;
                    } else {
                        p.vx *= 0.8;
                    }

                    // Jumping / Grab Rope
                    if (jumpKey) {
                        // Check if near a rope to grab
                        let grabbed = false;
                        this.ropes.forEach(rope => {
                            const endX = rope.x + Math.sin(rope.angle) * rope.length;
                            const endY = rope.y + Math.cos(rope.angle) * rope.length;
                            if (Math.hypot(p.x + p.w/2 - endX, p.y + p.h/2 - endY) < 60) {
                                p.swinging = rope;
                                grabbed = true;
                            }
                        });

                        if (!grabbed && p.grounded) {
                            p.vy = -16;
                            p.grounded = false;
                        }
                        this.keys['ArrowUp'] = this.keys['KeyW'] = this.keys['Space'] = false;
                    }
                } else {
                    // Swinging logic
                    const r = p.swinging;
                    p.x = r.x + Math.sin(r.angle) * r.length - p.w/2;
                    p.y = r.y + Math.cos(r.angle) * r.length - p.h/2;
                    p.vx = 0; p.vy = 0;
                    
                    if (jumpKey) {
                        p.vy = -14;
                        p.vx = Math.sin(r.angle) * 20;
                        p.swinging = null;
                        this.keys['ArrowUp'] = this.keys['KeyW'] = this.keys['Space'] = false;
                    }
                }

                // --- PHYSICS ---
                if (!p.climbing && !p.swinging) {
                    p.vy += 0.75; // Gravity
                }
                
                p.x += p.vx;
                p.y += p.vy;

                // --- COLLISIONS ---
                p.grounded = false;
                this.platforms.forEach(plat => {
                    if (p.vy >= 0 && p.y + p.h > plat.y && p.y + p.h < plat.y + 35 && p.x + p.w > plat.x && p.x < plat.x + plat.w) {
                        p.y = plat.y - p.h;
                        p.vy = 0;
                        p.grounded = true;
                    }
                });

                // Ladder Logic
                let onLadder = false;
                this.ladders.forEach(l => {
                    if (p.x + p.w/2 > l.x && p.x + p.w/2 < l.x + l.w && p.y + p.h > l.y && p.y < l.y + l.h) {
                        onLadder = true;
                        p.climbing = true;
                        if (this.keys['ArrowUp'] || this.keys['KeyW']) p.vy = -5;
                        else if (this.keys['ArrowDown'] || this.keys['KeyS']) p.vy = 5;
                        else p.vy = 0;
                    }
                });
                if (!onLadder) p.climbing = false;

                // Update Rope Angles
                this.ropes.forEach(rope => {
                    rope.angle = Math.sin(Date.now() / 800) * 1.1;
                });

                // Collectibles
                this.collectibles.forEach(c => {
                    if (!c.collected && Math.hypot(p.x - c.x, p.y - c.y) < 50) {
                        c.collected = true;
                        if (c.type === 'heart') {
                            this.lives = Math.min(5, this.lives + 1);
                            this.updateHearts();
                        } else {
                            this.score += 100;
                            document.getElementById('score-val').textContent = this.score;
                        }
                    }
                });

                // Enemies
                this.enemies.forEach(e => {
                    if (e.type === 'slime') {
                        e.x += e.vx;
                        if (Math.abs(e.x - e.startX) > e.range) e.vx *= -1;
                    }
                    if (Math.hypot(p.x - e.x, p.y - e.y) < 50) {
                        if (p.vy > 0 && p.y + p.h < e.y + 20) {
                            this.score += 500;
                            e.x = -1000;
                            p.vy = -12;
                        } else {
                            this.takeDamage();
                        }
                    }
                });

                this.cameraX = Math.max(this.cameraX, p.x - 400);
                if (p.y > 1000) this.takeDamage(true);
                if (Math.abs(p.vx) > 0.1) p.anim += 0.2;
            }

            takeDamage(fell = false) {
                if (this.invuln > 0) return;
                this.lives--;
                this.invuln = 80;
                this.updateHearts();
                
                if (this.lives <= 0) {
                    this.endGame();
                } else if (fell) {
                    this.player.x = this.cameraX + 100;
                    this.player.y = 200;
                    this.player.vx = 0; this.player.vy = 0;
                }
            }

            updateHearts() {
                document.getElementById('heart-container').textContent = '‚ù§Ô∏è'.repeat(this.lives);
            }

            endGame() {
                this.state = 'over';
                document.getElementById('game-over').style.display = 'flex';
                document.getElementById('final-stats').textContent = `Total Wealth: ${this.score} Gems`;
            }

            draw() {
                const ctx = this.ctx;
                ctx.clearRect(0, 0, this.width, this.height);

                ctx.save();
                ctx.translate(-this.cameraX, 0);

                // Clouds
                this.bgLayers.forEach(l => {
                    const lx = (l.x - this.cameraX * l.depth + 3000) % 4000 - 500;
                    ctx.fillStyle = `rgba(255,255,255, ${l.depth * 0.4})`;
                    ctx.beginPath(); ctx.ellipse(lx, l.y, l.w, l.w*0.4, 0, 0, Math.PI*2); ctx.fill();
                });

                // Platforms
                this.platforms.forEach(plat => {
                    ctx.fillStyle = plat.type === 'grass' ? '#2ecc71' : plat.type === 'dirt' ? '#8b4513' : '#d97706';
                    ctx.fillRect(plat.x, plat.y, plat.w, plat.h);
                    ctx.fillStyle = 'rgba(0,0,0,0.15)';
                    ctx.fillRect(plat.x, plat.y + 10, plat.w, plat.h - 10);
                });

                // Ladders
                this.ladders.forEach(l => {
                    ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = 5;
                    ctx.strokeRect(l.x, l.y, l.w, l.h);
                    for(let y=l.y; y<l.y+l.h; y+=25) {
                        ctx.beginPath(); ctx.moveTo(l.x, y); ctx.lineTo(l.x+l.w, y); ctx.stroke();
                    }
                });

                // Ropes
                this.ropes.forEach(rope => {
                    ctx.strokeStyle = '#451a03'; ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.moveTo(rope.x, rope.y);
                    ctx.lineTo(rope.x + Math.sin(rope.angle)*rope.length, rope.y + Math.cos(rope.angle)*rope.length);
                    ctx.stroke();
                    ctx.fillStyle = '#333'; ctx.beginPath(); ctx.arc(rope.x, rope.y, 8, 0, Math.PI*2); ctx.fill();
                });

                // Collectibles
                this.collectibles.forEach(c => {
                    if (c.collected) return;
                    ctx.font = '30px Arial';
                    ctx.fillText(c.type === 'heart' ? '‚ù§Ô∏è' : 'üíé', c.x - 15, c.y + 15);
                });

                // Enemies
                this.enemies.forEach(e => {
                    ctx.font = '40px Arial';
                    ctx.fillText(e.type === 'slime' ? 'üëæ' : 'üî∫', e.x - 20, e.y + 20);
                });

                // Player
                const p = this.player;
                ctx.save();
                ctx.translate(p.x + p.w/2, p.y + p.h/2);
                if (p.dir === -1) ctx.scale(-1, 1);
                const bob = Math.sin(p.anim) * 8;
                ctx.rotate(p.vx * 0.04);
                if (this.invuln % 10 > 5) ctx.globalAlpha = 0.3;
                ctx.font = `${p.h + 10}px Arial`;
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText(CHARS[this.charIdx], 0, bob);
                ctx.restore();

                ctx.restore();
            }

            loop() {
                if (this.invuln > 0) this.invuln--;
                this.update();
                this.draw();
                requestAnimationFrame(() => this.loop());
            }
        }

        window.app = new AdventureGame();
    </script>
</body>
</html>
