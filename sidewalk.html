<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidewalk: Real Life - K2 games</title>
    <style>
        :root {
            --sky-day: #87ceeb;
            --sky-sunset: #ff7e5f;
            --sky-night: #0f172a;
            --sidewalk: #94a3b8;
            --grass: #22c55e;
            --road: #334155;
            --accent: #38bdf8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: #000;
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            height: 750px;
            background: #000;
            border-radius: 24px;
            border: 8px solid #334155;
            box-shadow: 0 50px 100px rgba(0,0,0,0.8);
            overflow: hidden;
        }

        canvas { display: block; width: 100%; height: 100%; }

        #ui-layer {
            position: absolute;
            inset: 0;
            pointer-events: none;
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 100;
        }

        .hud-row { display: flex; justify-content: space-between; align-items: flex-start; }

        .hud-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            padding: 15px 25px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 160px;
        }

        .stat-val { font-size: 1.8rem; font-weight: 900; color: var(--accent); font-family: monospace; }
        .stat-label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 2px; opacity: 0.6; font-weight: 800; }

        .stamina-container {
            width: 200px;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        #stamina-fill { height: 100%; width: 100%; background: #22c55e; transition: width 0.1s; }

        .back-link {
            position: fixed; top: 20px; left: 20px; color: white; text-decoration: none;
            background: rgba(255,255,255,0.1); padding: 12px 20px; border-radius: 12px; z-index: 200;
            font-weight: bold; backdrop-filter: blur(10px); transition: 0.2s;
        }
        .back-link:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }

        .hint {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            color: rgba(255,255,255,0.4); font-size: 0.8rem; font-weight: 600; letter-spacing: 1px;
            text-align: center;
        }

        #inventory {
            position: absolute;
            top: 150px;
            left: 25px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .inv-item {
            background: rgba(0,0,0,0.5);
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê HUB</a>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="ui-layer">
            <div class="hud-row">
                <div class="hud-card">
                    <div class="stat-label">Distance Walked</div>
                    <div id="dist-val" class="stat-val">0.00 mi</div>
                    <div class="stat-label" style="margin-top: 10px;">Stamina</div>
                    <div class="stamina-container"><div id="stamina-fill"></div></div>
                </div>

                <div class="hud-card" style="text-align: right; align-items: flex-end;">
                    <div class="stat-label">Mountain Time (MT)</div>
                    <div id="time-val" class="stat-val">--:-- --</div>
                    <div id="date-val" class="stat-label" style="margin-top: 5px; opacity: 0.4;">---, --- --</div>
                </div>
            </div>

            <div id="inventory">
                <div class="inv-item">üí∞ Wallet: $<span id="money-val">0.00</span></div>
                <div class="inv-item">üêï Dogs Petted: <span id="dogs-val">0</span></div>
            </div>
        </div>

        <div class="hint">
            WASD TO MOVE ‚Ä¢ SHIFT TO SPRINT<br>
            SPACE TO INTERACT (PET DOGS / COLLECT COINS)
        </div>
    </div>

    <script>
        class SidewalkLife {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.width = 1200;
                this.height = 750;
                this.canvas.width = this.width;
                this.canvas.height = this.height;

                this.cameraZ = 0;
                this.speed = 0;
                this.maxSpeed = 5;
                this.accel = 0.12;
                this.groundY = 480;
                
                this.objects = []; 
                this.traffic = []; 
                this.pedestrians = []; 
                this.entities = []; // Coins, Dogs
                this.clouds = [];
                this.keys = {};
                
                this.stamina = 100;
                this.money = 0;
                this.dogsPetted = 0;

                this.init();
            }

            init() {
                for(let i=0; i<40; i++) {
                    this.spawnObject(i * 180 + 100);
                }
                for(let i=0; i<12; i++) {
                    this.clouds.push({
                        x: Math.random() * this.width,
                        y: 50 + Math.random() * 200,
                        w: 150 + Math.random() * 250,
                        s: 0.05 + Math.random() * 0.2
                    });
                }

                window.onkeydown = (e) => {
                    this.keys[e.code] = true;
                    if(e.code === 'Space') this.interact();
                };
                window.onkeyup = (e) => this.keys[e.code] = false;

                this.loop();
            }

            spawnObject(z) {
                const side = Math.random() < 0.5 ? 'L' : 'R';
                const rand = Math.random();
                let obj = { z, side };

                if (rand < 0.45) {
                    obj.type = 'building';
                    obj.w = 140 + Math.random() * 120;
                    obj.h = 300 + Math.random() * 500;
                    obj.color = `hsl(${Math.random()*360}, 15%, ${20 + Math.random()*30}%)`;
                    obj.windows = Array.from({length: Math.floor(obj.h/50) * 4}, () => Math.random() < 0.4);
                } else if (rand < 0.75) {
                    obj.type = 'tree';
                    obj.h = 100 + Math.random() * 120;
                } else if (rand < 0.9) {
                    obj.type = 'light';
                    obj.h = 180;
                } else {
                    obj.type = 'bench';
                }
                this.objects.push(obj);
            }

            spawnEntity(z) {
                const rand = Math.random();
                if (rand < 0.7) {
                    this.entities.push({ z, type: 'coin', xOff: 250 + Math.random()*100, collected: false });
                } else {
                    this.entities.push({ z, type: 'dog', xOff: 280, petted: false, color: ['#8B4513', '#D2B48C', '#000'][Math.floor(Math.random()*3)] });
                }
            }

            interact() {
                const near = this.entities.find(e => Math.abs(e.z - this.cameraZ) < 100);
                if (near) {
                    if (near.type === 'coin' && !near.collected) {
                        near.collected = true;
                        this.money += 0.25;
                    } else if (near.type === 'dog' && !near.petted) {
                        near.petted = true;
                        this.dogsPetted++;
                    }
                }
            }

            updateTime() {
                // Get MT (Mountain Time) - UTC-7
                const now = new Date();
                const mtTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Denver"}));
                
                const hours = mtTime.getHours();
                const mins = mtTime.getMinutes().toString().padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                const h12 = hours % 12 || 12;
                
                document.getElementById('time-val').textContent = `${h12}:${mins} ${ampm}`;
                document.getElementById('date-val').textContent = mtTime.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });

                // Use the MT hour to set game lighting (0 to 1)
                this.gameTimeFactor = (mtTime.getHours() * 60 + mtTime.getMinutes()) / 1440;
            }

            update() {
                this.updateTime();

                // Stamina & Speed
                const isSprinting = this.keys['ShiftLeft'] && this.stamina > 0;
                const targetMax = isSprinting ? this.maxSpeed * 2.2 : this.maxSpeed;
                
                if(this.keys['ArrowUp'] || this.keys['KeyW']) {
                    this.speed = Math.min(targetMax, this.speed + this.accel);
                    if (isSprinting) this.stamina = Math.max(0, this.stamina - 0.4);
                } else {
                    this.speed = Math.max(0, this.speed - this.accel * 1.5);
                }

                if (!isSprinting) this.stamina = Math.min(100, this.stamina + 0.2);
                document.getElementById('stamina-fill').style.width = this.stamina + '%';
                document.getElementById('stamina-fill').style.background = this.stamina < 30 ? '#ef4444' : '#22c55e';

                this.cameraZ += this.speed;

                // Update UI (Miles)
                const miles = this.cameraZ / 1609.34;
                document.getElementById('dist-val').textContent = miles.toFixed(2) + ' mi';
                document.getElementById('money-val').textContent = this.money.toFixed(2);
                document.getElementById('dogs-val').textContent = this.dogsPetted;

                // Generation
                if(this.objects.length < 50) {
                    const maxZ = Math.max(...this.objects.map(o => o.z), this.cameraZ);
                    this.spawnObject(maxZ + 160);
                }
                if(Math.random() < 0.015) this.spawnEntity(this.cameraZ + 2000);

                // Movement of others
                if(Math.random() < 0.02) {
                    this.traffic.push({
                        z: this.cameraZ + 3000, lane: Math.random() < 0.5 ? 0 : 1, 
                        speed: 12 + Math.random() * 8, color: `hsl(${Math.random()*360}, 60%, 40%)`
                    });
                }
                this.traffic.forEach(c => c.z -= c.speed);
                this.pedestrians.forEach(p => p.z += p.speed);

                // Cleanup
                this.objects = this.objects.filter(o => o.z - this.cameraZ > -500);
                this.traffic = this.traffic.filter(c => c.z - this.cameraZ > -500);
                this.entities = this.entities.filter(e => e.z - this.cameraZ > -500 && !e.collected);

                this.clouds.forEach(c => {
                    c.x += c.s;
                    if(c.x > this.width + 300) c.x = -300;
                });
            }

            draw() {
                const ctx = this.ctx;
                const f = this.gameTimeFactor;
                
                // Sky Color Logic based on real MT hour
                let sky;
                if (f < 0.2 || f > 0.8) sky = '#020617';
                else if (f < 0.3 || f > 0.7) sky = '#4c1d95';
                else sky = '#bae6fd';
                
                ctx.fillStyle = sky;
                ctx.fillRect(0, 0, this.width, this.height);

                // Ground
                ctx.fillStyle = '#064e3b';
                ctx.fillRect(0, this.groundY, this.width, this.height - this.groundY);

                // Road & Sidewalk
                ctx.fillStyle = '#1e293b';
                this.drawTrapezoid(this.width/2 - 450, this.width/2 + 50, 1.0); // Road
                ctx.fillStyle = '#64748b';
                this.drawTrapezoid(this.width/2 + 50, this.width/2 + 500, 1.0); // Sidewalk

                // Sort and Render
                const renderList = [
                    ...this.objects.map(o => ({...o, rType: 'obj'})),
                    ...this.traffic.map(c => ({...c, rType: 'car'})),
                    ...this.entities.map(e => ({...e, rType: 'ent'}))
                ].sort((a, b) => b.z - a.z);

                renderList.forEach(item => {
                    const dz = item.z - this.cameraZ;
                    if (dz < 0 || dz > 4000) return;

                    const scale = 800 / (dz + 800);
                    const cx = this.width/2 + (item.side === 'L' ? -500 : (item.rType === 'car' ? -200 : 300)) * scale;
                    
                    ctx.save();
                    ctx.translate(cx, this.groundY);
                    ctx.scale(scale, scale);

                    if (item.rType === 'obj') {
                        ctx.fillStyle = item.color;
                        if (item.type === 'building') {
                            ctx.fillRect(-item.w/2, -item.h, item.w, item.h);
                            ctx.fillStyle = (f < 0.25 || f > 0.75) ? '#fde047' : '#0f172a';
                            for(let i=0; i<8; i++) ctx.fillRect(-item.w/2 + 20 + (i%2)*60, -item.h + 40 + Math.floor(i/2)*80, 20, 30);
                        } else if (item.type === 'tree') {
                            ctx.fillStyle = '#451a03'; ctx.fillRect(-8, -30, 16, 30);
                            ctx.fillStyle = '#14532d'; ctx.beginPath(); ctx.arc(0, -80, 60, 0, Math.PI*2); ctx.fill();
                        } else if (item.type === 'light') {
                            ctx.fillStyle = '#334155'; ctx.fillRect(-4, -200, 8, 200);
                            if (f < 0.3 || f > 0.7) {
                                ctx.shadowBlur = 50; ctx.shadowColor = 'yellow';
                                ctx.fillStyle = 'yellow'; ctx.beginPath(); ctx.arc(0, -200, 15, 0, Math.PI*2); ctx.fill();
                            }
                        }
                    } else if (item.rType === 'car') {
                        ctx.fillStyle = item.color;
                        ctx.fillRect(-40, -50, 80, 50);
                        ctx.fillStyle = '#000'; ctx.fillRect(-35, -15, 20, 20); ctx.fillRect(15, -15, 20, 20);
                    } else if (item.rType === 'ent') {
                        const ex = item.xOff * (item.side === 'L' ? -1 : 1);
                        if (item.type === 'coin') {
                            ctx.fillStyle = '#fbbf24'; ctx.beginPath(); ctx.arc(ex, -10, 15, 0, Math.PI*2); ctx.fill();
                            ctx.strokeStyle = '#b45309'; ctx.stroke();
                        } else {
                            ctx.fillStyle = item.color; ctx.fillRect(ex, -30, 40, 30); // Simple dog
                            ctx.fillStyle = '#000'; ctx.fillRect(ex+30, -35, 10, 10);
                        }
                    }
                    ctx.restore();
                });

                requestAnimationFrame(() => { this.update(); this.draw(); });
            }

            drawTrapezoid(x1, x2, s) {
                const ctx = this.ctx;
                ctx.beginPath();
                ctx.moveTo(this.width/2 + (x1 - this.width/2)*0.1, this.groundY);
                ctx.lineTo(this.width/2 + (x2 - this.width/2)*0.1, this.groundY);
                ctx.lineTo(x2, this.height);
                ctx.lineTo(x1, this.height);
                ctx.fill();
            }
        }

        window.onload = () => new SidewalkLife();
    </script>
</body>
</html>
