<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Breakout Pro - K2 games</title>
    <style>
        :root {
            --primary: #6366f1;
            --accent: #f59e0b;
            --bg: #0f172a;
            --surface: #1e293b;
            --text: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', system-ui, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 95vmin;
            max-width: 480px;
            aspect-ratio: 4/5;
            padding: 10px;
        }

        canvas {
            background: #000;
            border: 4px solid var(--surface);
            border-radius: 12px;
            display: block;
            width: 100%;
            height: 100%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .hud {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 480px;
            margin-bottom: 15px;
            padding: 0 5px;
        }

        .stat { font-weight: 900; font-size: 1.2rem; display: flex; flex-direction: column; align-items: center; }
        .stat-label { font-size: 0.7rem; text-transform: uppercase; opacity: 0.6; letter-spacing: 1px; }
        .stat-value { color: var(--accent); }

        .back-link {
            position: fixed; top: 20px; left: 20px; color: white; text-decoration: none;
            background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 10px;
            font-weight: bold; font-size: 0.9rem; z-index: 100;
        }

        #overlay {
            position: absolute; inset: 0;
            background: rgba(15, 23, 42, 0.9);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 12px; z-index: 50; text-align: center;
        }

        .btn {
            background: var(--primary); color: white; border: none; padding: 12px 30px;
            border-radius: 50px; font-weight: 800; cursor: pointer; margin-top: 20px;
            font-size: 1.2rem;
            transition: transform 0.2s;
        }
        .btn:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê HUB</a>

    <div class="hud">
        <div class="stat"><span class="stat-label">Score</span><span id="score-val" class="stat-value">0</span></div>
        <div class="stat"><span class="stat-label">Level</span><span id="level-val" class="stat-value">1</span></div>
        <div class="stat"><span class="stat-label">Lives</span><span id="lives-val" class="stat-value">3</span></div>
    </div>

    <div id="game-container">
        <canvas id="breakout"></canvas>

        <div id="overlay">
            <h1 id="overlay-title" style="font-size: 3rem; color: var(--accent);">BREAKOUT PRO</h1>
            <p id="overlay-msg" style="margin-top: 10px;">Drag or use arrows to move</p>
            <button class="btn" id="start-btn">START GAME</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('breakout');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score-val');
        const levelEl = document.getElementById('level-val');
        const livesEl = document.getElementById('lives-val');
        const overlay = document.getElementById('overlay');
        const overlayTitle = document.getElementById('overlay-title');
        const startBtn = document.getElementById('start-btn');

        // Game state
        let score = 0;
        let lives = 3;
        let level = 1;
        let gameRunning = false;
        
        // Setup internal resolution
        const CW = 480;
        const CH = 600;
        canvas.width = CW;
        canvas.height = CH;

        // Constants
        const PADDLE_HEIGHT = 12;
        const PADDLE_WIDTH = 80;
        const BALL_RADIUS = 7;
        const BRICK_ROWS = 6;
        const BRICK_COLS = 7;
        const BRICK_HEIGHT = 20;
        const BRICK_PADDING = 8;
        const BRICK_OFFSET_TOP = 40;

        // Entities
        let paddle = { x: (CW - PADDLE_WIDTH) / 2, w: PADDLE_WIDTH, h: PADDLE_HEIGHT };
        let ball = { x: CW / 2, y: CH - 40, dx: 4, dy: -4 };
        let bricks = [];
        let powerups = [];

        // Controls
        let rightPressed = false;
        let leftPressed = false;

        function initBricks() {
            bricks = [];
            const rowCount = BRICK_ROWS + Math.min(4, level - 1);
            for (let c = 0; c < BRICK_COLS; c++) {
                bricks[c] = [];
                for (let r = 0; r < rowCount; r++) {
                    let status = 1;
                    if (level === 2 && (c + r) % 2 === 0) status = 0;
                    if (level >= 3 && (c % 2 === 0 && r % 2 === 0)) status = 0;
                    bricks[c][r] = { x: 0, y: 0, status: status, color: `hsl(${(r * 40 + level * 20) % 360}, 70%, 60%)` };
                }
            }
        }

        function drawBricks() {
            bricks.forEach((col, c) => {
                col.forEach((b, r) => {
                    if (b.status === 1) {
                        const bx = c * (CW / BRICK_COLS);
                        const by = r * (BRICK_HEIGHT + BRICK_PADDING) + BRICK_OFFSET_TOP;
                        b.x = bx + BRICK_PADDING;
                        b.y = by;
                        b.w = (CW / BRICK_COLS) - BRICK_PADDING * 2;
                        b.h = BRICK_HEIGHT;

                        ctx.beginPath();
                        ctx.roundRect(b.x, b.y, b.w, b.h, 4);
                        ctx.fillStyle = b.color;
                        ctx.fill();
                        ctx.closePath();
                    }
                });
            });
        }

        function drawPaddle() {
            ctx.beginPath();
            ctx.roundRect(paddle.x, CH - paddle.h - 10, paddle.w, paddle.h, 6);
            ctx.fillStyle = "white";
            ctx.fill();
            ctx.closePath();
        }

        function drawBall() {
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, BALL_RADIUS, 0, Math.PI * 2);
            ctx.fillStyle = "#f59e0b";
            ctx.fill();
            ctx.closePath();
        }

        function collisionDetection() {
            bricks.forEach(col => {
                col.forEach(b => {
                    if (b.status === 1) {
                        if (ball.x > b.x && ball.x < b.x + b.w && ball.y > b.y && ball.y < b.y + b.h) {
                            ball.dy = -ball.dy;
                            b.status = 0;
                            score += 10;
                            scoreEl.textContent = score;
                            
                            if (Math.random() < 0.1) {
                                powerups.push({ x: b.x + b.w/2, y: b.y, type: Math.random() > 0.5 ? 'WIDER' : 'LIFE' });
                            }

                            if (isLevelCleared()) {
                                nextLevel();
                            }
                        }
                    }
                });
            });
        }

        function isLevelCleared() {
            return bricks.every(col => col.every(b => b.status === 0));
        }

        function nextLevel() {
            level++;
            gameRunning = false;
            levelEl.textContent = level;
            overlayTitle.textContent = `LEVEL ${level}`;
            overlayTitle.style.color = "var(--primary)";
            overlay.style.display = 'flex';
            startBtn.textContent = "START LEVEL";
        }

        function update() {
            if (!gameRunning) return;

            ball.x += ball.dx;
            ball.y += ball.dy;

            if (ball.x + ball.dx > CW - BALL_RADIUS || ball.x + ball.dx < BALL_RADIUS) ball.dx = -ball.dx;
            if (ball.y + ball.dy < BALL_RADIUS) ball.dy = -ball.dy;
            else if (ball.y + ball.dy > CH - paddle.h - 10) {
                if (ball.x > paddle.x && ball.x < paddle.x + paddle.w) {
                    let hitPoint = (ball.x - (paddle.x + paddle.w / 2)) / (paddle.w / 2);
                    ball.dx = hitPoint * 5;
                    ball.dy = -Math.abs(ball.dy);
                } else if (ball.y > CH) {
                    lives--;
                    livesEl.textContent = lives;
                    if (!lives) gameOver();
                    else resetBall();
                }
            }

            if (rightPressed && paddle.x < CW - paddle.w) paddle.x += 7;
            else if (leftPressed && paddle.x > 0) paddle.x -= 7;

            powerups.forEach((p, i) => {
                p.y += 3;
                if (p.y > CH - paddle.h - 20 && p.x > paddle.x && p.x < paddle.x + paddle.w) {
                    if (p.type === 'WIDER') { paddle.w = Math.min(150, paddle.w + 20); setTimeout(() => paddle.w = PADDLE_WIDTH, 8000); }
                    if (p.type === 'LIFE') { lives++; livesEl.textContent = lives; }
                    powerups.splice(i, 1);
                }
            });

            collisionDetection();
        }

        function drawPowerups() {
            powerups.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, 10, 0, Math.PI*2);
                ctx.fillStyle = p.type === 'WIDER' ? '#38bdf8' : '#ef4444';
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(p.type[0], p.x, p.y + 4);
                ctx.closePath();
            });
        }

        function draw() {
            ctx.clearRect(0, 0, CW, CH);
            drawBricks();
            drawBall();
            drawPaddle();
            drawPowerups();
            update();
            requestAnimationFrame(draw);
        }

        function resetBall() {
            ball.x = CW / 2;
            ball.y = CH - 40;
            ball.dx = (Math.random() - 0.5) * 4;
            ball.dy = -4;
            paddle.x = (CW - paddle.w) / 2;
            gameRunning = false;
            overlay.style.display = 'flex';
            overlayTitle.textContent = "READY?";
            overlayTitle.style.color = "var(--accent)";
            startBtn.textContent = "LAUNCH BALL";
        }

        function gameOver() {
            gameRunning = false;
            overlayTitle.textContent = "GAME OVER";
            overlayTitle.style.color = "#ef4444";
            startBtn.textContent = "RETRY";
            overlay.style.display = 'flex';
            score = 0; scoreEl.textContent = 0;
            level = 1; levelEl.textContent = 1;
            lives = 3; livesEl.textContent = 3;
        }

        document.addEventListener("keydown", (e) => {
            if (e.key === "Right" || e.key === "ArrowRight" || e.key === "d") rightPressed = true;
            else if (e.key === "Left" || e.key === "ArrowLeft" || e.key === "a") leftPressed = true;
        });
        document.addEventListener("keyup", (e) => {
            if (e.key === "Right" || e.key === "ArrowRight" || e.key === "d") rightPressed = false;
            else if (e.key === "Left" || e.key === "ArrowLeft" || e.key === "a") leftPressed = false;
        });

        const handleMove = (e) => {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const x = clientX - rect.left;
            const scale = CW / rect.width;
            paddle.x = (x * scale) - paddle.w / 2;
            if (paddle.x < 0) paddle.x = 0;
            if (paddle.x > CW - paddle.w) paddle.x = CW - paddle.w;
        };

        canvas.addEventListener('mousemove', (e) => { if (gameRunning) handleMove(e); });
        canvas.addEventListener('touchmove', (e) => { 
            if (gameRunning) {
                handleMove(e);
                e.preventDefault();
            }
        }, { passive: false });

        startBtn.addEventListener('click', () => {
            if (overlayTitle.textContent === "BREAKOUT PRO" || overlayTitle.textContent === "GAME OVER") {
                initBricks();
            }
            gameRunning = true;
            overlay.style.display = 'none';
        });

        initBricks();
        draw();
    </script>
</body>
</html>
