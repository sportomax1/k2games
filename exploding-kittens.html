<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exploding Kittens: Digital - K2 games</title>
    <style>
        :root {
            --bg: #1a1a1a;
            --card-front: #ffffff;
            --card-back: #e74c3c;
            --accent: #f1c40f;
            --text: #333333;
            --panel: rgba(255, 255, 255, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Game Layout */
        #game-board {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            background: radial-gradient(circle, #2c3e50, #000000);
        }

        /* Opponents Area */
        #opponents {
            display: flex;
            justify-content: center;
            gap: 40px;
        }
        .ai-player {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: var(--panel);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: 0.3s;
        }
        .ai-player.active { border-color: var(--accent); box-shadow: 0 0 20px var(--accent); }

        /* Center Deck Area */
        #center {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 50px;
        }

        .deck, .discard {
            width: 120px;
            height: 170px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 800;
            font-size: 1.2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }
        .deck { background: var(--card-back); border: 4px solid white; color: white; }
        .deck:hover { transform: translateY(-5px); }
        .discard { background: rgba(255,255,255,0.1); border: 2px dashed rgba(255,255,255,0.3); color: rgba(255,255,255,0.3); }

        /* Player Hand Area */
        #player-hand-container {
            display: flex;
            justify-content: center;
            height: 220px;
            padding-bottom: 20px;
        }
        #player-hand {
            display: flex;
            justify-content: center;
            width: fit-content;
        }

        .card {
            width: 130px;
            height: 185px;
            background: white;
            border-radius: 10px;
            margin-left: -50px;
            padding: 12px;
            color: var(--text);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            border: 1px solid #ddd;
        }
        .card:first-child { margin-left: 0; }
        .card:hover { transform: translateY(-40px) scale(1.1); z-index: 100 !important; margin-right: 50px; }
        .card.selected { border: 4px solid var(--accent); transform: translateY(-60px); }

        .card-emoji { font-size: 2.5rem; text-align: center; margin: 10px 0; }
        .card-title { font-weight: 800; font-size: 0.9rem; text-align: center; text-transform: uppercase; }
        .card-desc { font-size: 0.7rem; color: #666; line-height: 1.2; margin-top: auto; }

        /* Turn Log */
        #log {
            position: fixed; top: 20px; right: 20px; width: 250px; max-height: 300px;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(10px);
            padding: 15px; border-radius: 12px; font-size: 0.8rem; overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .log-entry { margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 4px; }

        .back-link {
            position: fixed; top: 20px; left: 20px; color: white; text-decoration: none;
            background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 8px; z-index: 100;
        }

        /* Overlay */
        #setup-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(10px);
        }
        .setup-box { background: #222; padding: 40px; border-radius: 30px; border: 2px solid var(--accent); text-align: center; }

        .btn {
            background: var(--accent); color: black; border: none; padding: 12px 30px;
            border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1.1rem;
            margin-top: 20px; transition: 0.2s;
        }
        .btn:hover { transform: scale(1.05); }

    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê HUB</a>

    <div id="game-board">
        <div id="opponents"></div>

        <div id="center">
            <div class="deck" id="main-deck">DECK</div>
            <div class="discard" id="discard-pile">DISCARD</div>
        </div>

        <div id="player-hand-container">
            <div id="player-hand"></div>
        </div>
    </div>

    <div id="log"></div>

    <div id="setup-overlay">
        <div class="setup-box">
            <h1 style="font-size: 3rem; color: var(--accent); margin-bottom: 1rem;">EXPLODING KITTENS</h1>
            <p style="margin-bottom: 2rem; opacity: 0.8;">Don't blow up. That's pretty much it.</p>
            <button class="btn" onclick="startGame()">START GAME</button>
        </div>
    </div>

    <script>
        const CARD_TYPES = [
            { type: 'Exploding Kitten', emoji: 'üí•', count: 4, desc: 'Avoid drawing this unless you have a Defuse!' },
            { type: 'Defuse', emoji: 'üíö', count: 6, desc: 'Prevents explosion. Put the kitten back anywhere.' },
            { type: 'Attack', emoji: '‚öîÔ∏è', count: 4, desc: 'End your turn, next player takes two turns.' },
            { type: 'Skip', emoji: 'üèÉ', count: 4, desc: 'End your turn without drawing.' },
            { type: 'Shuffle', emoji: 'üåÄ', count: 4, desc: 'Shuffle the deck.' },
            { type: 'See Future', emoji: 'üîÆ', count: 5, desc: 'Peek at the top 3 cards.' },
            { type: 'Taco Cat', emoji: 'üåÆ', count: 4, desc: 'Collect two to steal from a player.' }
        ];

        class Game {
            constructor() {
                this.deck = [];
                this.discard = [];
                this.players = [
                    { id: 'player', name: 'You', hand: [], isAI: false },
                    { id: 'ai1', name: 'Mr. Whiskers', hand: [], isAI: true },
                    { id: 'ai2', name: 'Cat-o-tron', hand: [], isAI: true }
                ];
                this.currentPlayerIdx = 0;
                this.turnsLeft = 1;
                this.isGameOver = false;

                this.init();
            }

            init() {
                this.buildDeck();
                this.dealHands();
                this.insertKittens();
                this.render();
                this.log("Game started! Good luck.");
            }

            buildDeck() {
                CARD_TYPES.forEach(ct => {
                    if(ct.type !== 'Exploding Kitten' && ct.type !== 'Defuse') {
                        for(let i=0; i<ct.count; i++) this.deck.push({...ct});
                    }
                });
                this.shuffle(this.deck);
            }

            dealHands() {
                this.players.forEach(p => {
                    p.hand.push({ type: 'Defuse', emoji: 'üíö', desc: 'Prevents explosion.' });
                    for(let i=0; i<4; i++) p.hand.push(this.deck.pop());
                });
            }

            insertKittens() {
                for(let i=0; i<this.players.length-1; i++) {
                    this.deck.push({ type: 'Exploding Kitten', emoji: 'üí•', desc: 'YOU EXPLODE!' });
                }
                this.shuffle(this.deck);
            }

            shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            log(msg) {
                const logEl = document.getElementById('log');
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.textContent = `> ${msg}`;
                logEl.prepend(entry);
            }

            render() {
                // Render Opponents
                const opps = document.getElementById('opponents');
                opps.innerHTML = '';
                this.players.forEach((p, i) => {
                    if(p.id !== 'player') {
                        const div = document.createElement('div');
                        div.className = `ai-player ${this.currentPlayerIdx === i ? 'active' : ''}`;
                        div.innerHTML = `
                            <div style="font-size: 2rem;">üê±</div>
                            <div style="font-weight: bold;">${p.name}</div>
                            <div style="font-size: 0.8rem; opacity: 0.6;">${p.hand.length} Cards</div>
                        `;
                        opps.appendChild(div);
                    }
                });

                // Render Player Hand
                const handEl = document.getElementById('player-hand');
                handEl.innerHTML = '';
                this.players[0].hand.forEach((card, i) => {
                    const div = document.createElement('div');
                    div.className = 'card';
                    div.style.zIndex = i;
                    div.innerHTML = `
                        <div class="card-title">${card.type}</div>
                        <div class="card-emoji">${card.emoji}</div>
                        <div class="card-desc">${card.desc}</div>
                    `;
                    div.onclick = () => this.playCard(0, i);
                    handEl.appendChild(div);
                });

                // Deck Count
                document.getElementById('main-deck').textContent = `${this.deck.length} CARDS`;
                document.getElementById('main-deck').onclick = () => {
                    if(this.currentPlayerIdx === 0) this.drawCard(0);
                };

                // Discard
                if(this.discard.length > 0) {
                    const top = this.discard[this.discard.length-1];
                    document.getElementById('discard-pile').innerHTML = `
                        <div style="font-size: 2.5rem;">${top.emoji}</div>
                    `;
                }
            }

            drawCard(pIdx) {
                const p = this.players[pIdx];
                const card = this.deck.pop();
                this.log(`${p.name} drew a card.`);

                if(card.type === 'Exploding Kitten') {
                    const defuseIdx = p.hand.findIndex(c => c.type === 'Defuse');
                    if(defuseIdx > -1) {
                        p.hand.splice(defuseIdx, 1);
                        this.log(`üí• ${p.name} defused the kitten!`);
                        this.deck.push(card);
                        this.shuffle(this.deck);
                    } else {
                        this.log(`üíÄ BOOM! ${p.name} exploded!`);
                        this.isGameOver = true;
                        if(pIdx === 0) alert("GAME OVER! You exploded!");
                        else alert(`${p.name} exploded! You Win!`);
                        location.reload();
                        return;
                    }
                } else {
                    p.hand.push(card);
                }

                this.turnsLeft--;
                if(this.turnsLeft <= 0) {
                    this.currentPlayerIdx = (this.currentPlayerIdx + 1) % this.players.length;
                    this.turnsLeft = 1;
                }
                this.render();
                
                if(this.players[this.currentPlayerIdx].isAI) {
                    setTimeout(() => this.aiTurn(), 1000);
                }
            }

            playCard(pIdx, cIdx) {
                if(this.currentPlayerIdx !== pIdx) return;
                const p = this.players[pIdx];
                const card = p.hand.splice(cIdx, 1)[0];
                this.discard.push(card);
                this.log(`${p.name} played ${card.type}.`);

                switch(card.type) {
                    case 'Skip':
                        this.turnsLeft = 0;
                        break;
                    case 'Attack':
                        this.turnsLeft = 0;
                        const nextIdx = (this.currentPlayerIdx + 1) % this.players.length;
                        this.turnsLeft = 2; // Next player takes 2 turns
                        this.currentPlayerIdx = nextIdx;
                        break;
                    case 'Shuffle':
                        this.shuffle(this.deck);
                        break;
                    case 'See Future':
                        if(pIdx === 0) {
                            const top = this.deck.slice(-3).map(c => c.type).join(', ');
                            alert(`Top 3 cards: ${top}`);
                        }
                        break;
                }

                if(this.turnsLeft <= 0) {
                    this.currentPlayerIdx = (this.currentPlayerIdx + 1) % this.players.length;
                    this.turnsLeft = 1;
                }

                this.render();
                if(this.players[this.currentPlayerIdx].isAI) {
                    setTimeout(() => this.aiTurn(), 1000);
                }
            }

            aiTurn() {
                const p = this.players[this.currentPlayerIdx];
                // AI logic: Play a card if it has one (50% chance), otherwise draw
                if(p.hand.length > 1 && Math.random() > 0.5) {
                    const idx = Math.floor(Math.random() * p.hand.length);
                    if(p.hand[idx].type !== 'Defuse') {
                        this.playCard(this.currentPlayerIdx, idx);
                        return;
                    }
                }
                this.drawCard(this.currentPlayerIdx);
            }
        }

        let game;
        function startGame() {
            document.getElementById('setup-overlay').style.display = 'none';
            game = new Game();
        }
    </script>
</body>
</html>
